[
    {
        "title": "Class-Conditional Conformal Prediction for Imbalanced Data via Top-$k$ Classes"
    },
    {
        "review": {
            "id": "vqPatMkZiM",
            "forum": "Dtxc7mlKRg",
            "replyto": "Dtxc7mlKRg",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission8076/Reviewer_zE7U"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission8076/Reviewer_zE7U"
            ],
            "content": {
                "summary": {
                    "value": "This paper is motivated by multiclass imbalanced classification, where some classes are very rare. Often, classifiers optimizing for accuracy or similar metrics do not predict such classes ever. This paper proposes k-Class-Conditional Conformal Prediction (k-CCP). The main idea is to modify Class-Conformal Prediction by only considering the top k classes from the classifier. The main goal is to ensure that the prediction set is not too large. Theoretical and numerical results are provided."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "2 fair"
                },
                "contribution": {
                    "value": "2 fair"
                },
                "strengths": {
                    "value": "* The paper provides three discrete contributions: (1) a theorem that standard conformal prediction (here, marginal conformal prediction), is insufficient for class conformal prediction (CCP), (2) the k-CCP algorithm, and (3) a theoretical analysis of k-CCP.\n* The paper is fairly clear."
                },
                "weaknesses": {
                    "value": "* The value of the k-CCP contribution over CCP is unclear. It seems relatively modest to restrict to the top-k classes. Additionally, the importance of Theorem 2 and the numerical results are unclear to me. For the theorem, the condition is fairly unintuitive. For the numerical results, e.g., Table 1, I'm not sure that setting the UCR of k-CCP and CCP to be the same necessarily leads to a fair comparison. At some point, it seems like you have to trade off class conditioned coverage and prediction set size."
                },
                "questions": {
                    "value": "* A concrete real-world example would be better. Most of the experiments are on vision, but the only application mentioned in the abstract and introduction are general references to medical diagnoses.\n* A concrete example instead of or combined with Proposition 1 would help. Intuitively, it seems like conformal prediction with imbalanced classes would suffer the same problems as accuracy optimization--the classes that have few samples in training/calibration data are unlikely to be predicted. It seems like a more intuitive example could be provided.\n* The algorithms could be written out more clearly without referencing theorems, remarks, and equations in the main text.\n* There are some typos (\"pupulation\" p. 3, \"K\" for the number of classes p. 6)."
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "3: reject, not good enough"
                },
                "confidence": {
                    "value": "2: You are willing to defend your assessment, but it is quite likely that you did not understand the central parts of the submission or that you are unfamiliar with some pieces of related work. Math/other details were not carefully checked."
                },
                "code_of_conduct": {
                    "value": "Yes"
                }
            },
            "number": 1,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission8076/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698008269205,
            "cdate": 1698008269205,
            "tmdate": 1699637000160,
            "mdate": 1699637000160,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "kRwIIsA2iC",
                "forum": "Dtxc7mlKRg",
                "replyto": "vqPatMkZiM",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response For Reviewer zE7U"
                    },
                    "comment": {
                        "value": "We thank the reviewer for their thoughtful comments and feedback.\n\nQ1: **The value of the k-CCP contribution over CCP is unclear. It seems relatively modest to restrict to the top-k classes.**\n\nA1: The $k$-CCP algorithm adapts the double calibration mechanism (calibration on both non-conformity score and ranks in Equation (9), instead of a single calibration in standard CCP) to take a good trade-off of coverage and efficiency. The key advantage of the additional calibration over rank is to exclude those data where their true labels are ranked beyond top-$\\widehat k(y)$ positions (i.e., poorly predicted data) in the calibration process, which in turn helps remove labels beyond top-$\\widehat k(y)$ positions in the testing process.\n\nQ2: **The importance of Theorem 2 and the numerical results are unclear.**\n\nA2: The contribution of Theorem 2 is to theoretically identify the source of reduced prediction set sizes by $k$-CCP, so that it enables verification in experimental results shown in Figure 1 (last column). We additionally verify it on calibration data in Figure 24 of the updated paper. We believe that Theorem 2 reveals this insight/knowledge and wraps up the key factors into the condition numbers $\\sigma_y$.\n\nOur experiments on multiple benchmark datasets demonstrate the following three remarks.\n\n(i) MCP fails to provide class-conditional coverage in the first columns of Figure 1 and 4 . \n\n(2) $k$-CCP produces smaller prediction sets over the baseline CCP method in Table 1. We also added Table 15, 16, and 17 in our revised paper to compare $k$-CCP with cluster-CP [R20] (a newly added baseline for achieving approximate class-conditional coverage) with APS score function (Table 15) and RAPS score function [R21] (Table 16). Moreover, we perform comparison between $k$-CCP and the above CP algorithms using a conformalized training algorithm [R22] (Table 17). \n\n(3) The condition numbers $\\sigma_y$ in Theorem 2 are valid and verified in the last columns of Figure 1 and 4. We also added Figure 24 in our revised paper that verifies these condition numbers on calibration data.\n\nQ3: **For the theorem, the condition is fairly unintuitive.** \n\nA3: The condition (12) in Theorem 1 in the revised paper  follows the algorithmic design in Algorithm 1, i.e., iterating over all classes, which results in the summation over $y \\in \\mathcal Y$ in (12). Within each element (a fixed $y$), we define a condition $\\sigma_y$ as the source of the reduced prediction set size for $k$-CCP. This insight can be easily verified in experiments (The last columns of Figure 1 and 4) and theoretically supports smaller prediction sets from $k$-CCP.\n\nQ4: **For the numerical results, e.g., Table 1 (Table 15 and 16 in our revised paper), I'm not sure that setting the UCR of k-CCP and CCP to be the same necessarily leads to a fair comparison.**\n\nA4: It is necessary to set UCR to the same value (also close to $0$) for all methods, because it is a measure of the violation of class-conditional coverage. Our paper studies the efficiency of CP methods that guarantees the class-conditional coverage. If UCR is not close to $0$ (like MCP), we cannot verify the class-conditional coverage is achieved, so that it is consequently not meaningful to compare prediction set sizes as the measure of efficiency.\n\n\nQ5: **A concrete example instead of or combined with Proposition 1 would help. It seems like a more intuitive example could be provided.**\n\nA5: We would like Proposition 1 to be a general and easy-to-verify theoretical result. This is why we did not connect it to the learning observation (recall that a key advantage of CP is model-agnostic, i.e., invariant to the learning algorithm). Instead, we can easily interpret from Proposition 1 and experiments to verify the conditions. The first columns of Figure 1 and 4 show the ease of under-coverage of MCP over each class, which in fact provides a concrete illustration for Proposition 1.\n\nQ6: **The algorithms could be written out more clearly without referencing theorems, remarks, and equations in the main text.**\n\nA6: Thank you for your suggestion. We have revised $k$-CCP in the Algorithm 1 (in our updated paper) by linking Line 5 to the new Equation (11) in the updated paper, i.e., $\\widehat k(y) = \\min\\{ c \\in [C]: \\frac{1}{n_y} \\sum_{i \\in \\mathcal I_y}  1[ r_f(X_i, Y_i) > c ] \\leq \\alpha - g / \\sqrt{n_y} \\}$, where $1[]$ is the indicator function. \n\n[R20] Ding, T., Angelopoulos, A. N., Bates, S., Jordan, M. I., & Tibshirani, R. J. (2023). Class-Conditional Conformal Prediction With Many Classes. arXiv preprint arXiv:2306.09335.\n\n[R21] Angelopoulos, A., Bates, S., Malik, J., & Jordan, M. I. (2020). Uncertainty sets for image classifiers using conformal prediction. arXiv preprint arXiv:2009.14193.\n\n[R22] Stutz, D., Cemgil, A. T., & Doucet, A. (2021). Learning optimal conformal classifiers. arXiv preprint arXiv:2110.09192."
                    }
                },
                "number": 12,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700360742109,
                "cdate": 1700360742109,
                "tmdate": 1700555507893,
                "mdate": 1700555507893,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "BhhBoVU79V",
                "forum": "Dtxc7mlKRg",
                "replyto": "kRwIIsA2iC",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Reviewer_zE7U"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Reviewer_zE7U"
                ],
                "content": {
                    "title": {
                        "value": "Read response"
                    },
                    "comment": {
                        "value": "I thank the authors for the response, and I still remain unconvinced of the contribution."
                    }
                },
                "number": 17,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700652875994,
                "cdate": 1700652875994,
                "tmdate": 1700652875994,
                "mdate": 1700652875994,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "g0ANYAt5Ok",
            "forum": "Dtxc7mlKRg",
            "replyto": "Dtxc7mlKRg",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission8076/Reviewer_KjCS"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission8076/Reviewer_KjCS"
            ],
            "content": {
                "summary": {
                    "value": "This paper proposes a method for achieving class conditional coverage for conformal prediction. This method uses the top-k error to form thresholds for each class for Conformal Prediction. They empirically demonstrate that the length of the sets generated by existing class conditional CP methods is suboptimal compared to the proposed methods' prediction sets.\n\nI have updated my score to a 6 to reflect the answers in the rebuttal. With adding more baselines, I feel this paper would be an 8. The theoretical contributions are currently strong, and the empirical contributions are fair."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "3 good"
                },
                "contribution": {
                    "value": "3 good"
                },
                "strengths": {
                    "value": "1. The investigation into the over-coverage and under coverage is a good addition to demonstrate the need for class conditional coverage methods to be generated. \n2. The intuition of using the top-k classes to remove spurious classes is quite a nice and intuitive idea. Moreover, besides the choice of baseline, the experimental setup seems well done.\n3. The analysis for Class Conditional Coverage seems quite thorough."
                },
                "weaknesses": {
                    "value": "1. The abstract is inappropriately long. The in-depth descriptions of the contributions should be reserved for the introduction to improve readability. \n2. The notation of the paper is slightly confusing. For example, you use $r_f(X, Y)$ at the beginning of Section 4.2, where $X, Y$ are datasets. However, earlier, you use $r_f(X_{n+1}, y)$ correspond to a specific datapoint $X_{n+1}, y$. Which is it? Moreover, one uses $\\epsilon_y$ to denote the top-k error but $\\epsilon_{n_y}$ to denote a general constant. Using $\\epsilon$ for a general constant definition is not a great practice, in my opinion, and greatly complicates the reading.\n3. The computation of $\\hat{k}(y)$ that achieves sufficiently small $\\epsilon_{y}$ seems very difficult. Indeed, the equation provided to calculate this calibrated class value seems very computationally expensive to find. Moreover, it seems that the quality of the generated sets is highly dependent on $g$. I believe two additional explorations should be included in this work. The first is an ablation oon how different values of $g$ affect the generated length of the sets. If the prediction sets' quality is only strong for different $g$, which vary greatly between different hyperparameters, then doing a hyperparameter search for different $g$ for every individual dataset is very expensive. Comparing a method for which the hyperparameters have been extensively tuned to another algorithm for which this is not the case is not a fair empirical comparison. Moreover, a detailed section on the computability of the calibrated class is in order. It seems that you need to do a linear search over the calibrated dataset many times, which is far more expensive than traditional Split Conformal Prediction. A breakdown here would be nice. \n4. The assumption in Theorem 2, i.e., equation 10, is a very strong assumption. More proper detail should go into detailing when this assumption holds and how. It seems to me that the heavy lifting of the proof of this theorem is done by this strong assumption. It is not clear to me when this assumption should hold. \n5.  I am surprised there is only one baseline for CCP. I believe a vast array of methods for CCP should be compared. This could include the methods from (\"Class-Conditional Conformal Prediction With Many Classes\", \"Classification with Valid and Adaptive Coverage\", \"Improving Conditional Coverage via Orthogonal\nQuantile Regression\", \"A Gentle Introduction to Conformal Prediction and Distribution-Free Uncertainty Quantification\"). There is a vast array of CCP works, and comparing to the most basic method is insufficient, in my opinion."
                },
                "questions": {
                    "value": "1. This notion of class conditional coverage is strictly weaker than the traditional conditional coverage often discussed in literature. Do existing conditional coverage methods such as those mentioned in \"A Gentle Introduction to Conformal Prediction and\nDistribution-free uncertainty Quantification\" achieves suboptimal set length compared to this weaker notion of conditional coverage.\n2. If the nominated coverage $\\tilde{\\alpha}$ is larger than $\\alpha$, then why are the generated sets shorter? This is not immediately clear to me. Is it because this allows for the use of only the top-k classes, which shortens the intervals? \n3. In the experiments, how were the hyperparameters chosen? I don't see where values such as $g$ were chosen. Were the hyperparameters for the baselines chosen in a similar manner to that of the proposed method?\n4. Do existing works guarantee that their method of CCP outperforms the naive CCP method in terms of the size of the prediction set, or is this unique to this work?"
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "6: marginally above the acceptance threshold"
                },
                "confidence": {
                    "value": "4: You are confident in your assessment, but not absolutely certain. It is unlikely, but not impossible, that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work."
                },
                "code_of_conduct": {
                    "value": "Yes"
                },
                "first_time_reviewer": {
                    "value": "Yes",
                    "readers": [
                        "ICLR.cc/2024/Conference/Program_Chairs",
                        "ICLR.cc/2024/Conference/Submission8076/Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission8076/Reviewer_KjCS",
                        "ICLR.cc/2024/Conference/Submission8076/Senior_Area_Chairs"
                    ]
                }
            },
            "number": 2,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission8076/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698360795828,
            "cdate": 1698360795828,
            "tmdate": 1700441846319,
            "mdate": 1700441846319,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "PZdWZsrCJ5",
                "forum": "Dtxc7mlKRg",
                "replyto": "g0ANYAt5Ok",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response For Reviewer KjCS"
                    },
                    "comment": {
                        "value": "We thank the reviewer for their thoughtful comments and feedback.\n\nQ1: **The proof demonstrating superiority to naive CCP relies on a strong assumption.**\n\nA1: Theorem 2 is a general result and depends on very mild assumptions.\n\n1. No assumption on top-$k$ accuracy \n\nWe clarify that our $k$-CCP algorithm is model-agnostic, since it does not impose any assumed properties of the learned classifier and can be used with any pre-trained classifier. The only extra information (compared with standard CP, such as MCP and CCP) is to estimate the top-$k$ accuracy (or equivalently, top-$k$ error in Remark 2) to determine the calibrated rank $\\widehat k(y)$. However, estimation of the top-$k$ error does not make any assumption on the learned classifier, since taking different values of $\\widehat k(y)$ from $1$ to $C$ gives a full span of $[0, 1]$ for top-$k$ accuracy. Therefore, our method remains valid and practically classifier agnostic.\n\n\n2. Assumption in Equation (10) (Equation (12) in our updated paper)  is commonly satisfied\n\nThe only assumption of condition numbers $\\sigma_y$ in Equation (12) is commonly satisfied and supported by empirical results (see Section 5.2, Figure 1, the last column with the standard training process). In addition, in Figure 24 of the updated paper, we also verify this assumption firmly holds on the calibration set.\n\nQ2: **The notation of the paper is slightly confusing. Using $r_f(X,Y)$, where $X,Y$ are datasets. However, earlier, using $r_f(X_{n+1},y)$ correspond to a specific datapoint $X_{n+1},y$. Which is it?**\n\nA2: We summarize our main notations in Section 2. Specifically, \u201c$(X, Y)$ is a data sample\u201d, and $\\mathcal D$ denotes the dataset, e.g., the training set $\\mathcal D_{\\text{tr}}$ and the calibration set $\\mathcal D_{\\text{cal}}$. Moreover, $r_f(X, Y)$ denotes the rank of the ground-truth label $Y$ predicted by the classifier $f$ on input $X$.\n\nIn Equation (3) of Section 3, we introduce \u201ca new testing input $X_{n+1}$\u201d. Accordingly, in Section 4.1 and 4.2, $r_f(X_{n+1}, y)$ denotes the rank of $y$ (this $y$ may be any label rather than the ground-truth one) predicted by classifier $f$ on the testing data $X_{n+1}$, where $y$ is a fixed label. Both CCP and $k$-CCP require iterating over all possible $y$ from $\\mathcal Y$ (in our multiclass case, $\\mathcal Y = \\{1, \\cdots,C\\}$ for a total of $C$ classes).\n\nQ3: **The computation of $\\hat k(y)$ that achieves sufficiently small \u03f5y seems very difficult. Indeed, the equation provided to calculate this calibrated class value seems very computationally expensive to find.** \n\nA3: Verifying if Equation 10 is satisfied in practice does not require significant computation/data overhead. The complexity for verification is $O(n C)$ (or improved to $O(n \\log(C))$ with binary search over classes from top-$1$ to top-$C$ for a large value $C$) with $n$ calibration samples (or $n$ testing samples if verification on testing data) and $C$ classes. Under the standard i.i.d. condition, the empirical estimates approximate population values in $O(1/\\sqrt{n})$.\n\nQ4: **Comparing a method for which the hyperparameters have been extensively tuned to another algorithm for which this is not the case is not a fair empirical comparison.** \n\nA4: Our $k$-CCP does not require more hyper-parameters to be tuned compared with baselines CCP and cluster-CP [R13] (an added baseline in the updated paper, Table 1, 15, 16, and 17, Figure 1, 2, 4, 5, and 24 in our updated paper). The only hyper-parameter $g$ has to be tuned for each CP method to achieve class-conditional coverage (their UCR close to $0$), under which we can compare their prediction set sizes as an efficiency measure. As a result, we believe our experiments provide a fair comparison.\n\nQ5: **Moreover, a detailed section on the computability of the calibrated class is in order.**\n\nA5: See A3 above Q3.\n\nQ6: **The assumption in Theorem 2, i.e., equation 10 (Equation (12) in our updated paper), is a very strong assumption.**\n\nA6: See A1 above Q1.\n\nQ7: **Do existing conditional coverage methods [12]  achieves suboptimal set length compared to this weaker notion of conditional coverage.**\n\nA7: Indeed the class-conditional coverage is a special notion of general conditional coverage (such as the group-conditional coverage of Mondrian conformal predictor [R18], [R13]). However, the general conditional CP can be realized to multiple subtypes, including attribute conformal prediction [R18] and input-conditional conformal prediction [R19]. Consequently, these different realized algorithms for various conditional coverages are not directly comparable.\n\nIn our experiments, we have selected the CCP which is introduced in [R16] (also refer to [R17]) as the baseline, without comparing with other non-comparable conditional CP methods. In addition, we added a new baseline cluster-CP [R13], a CP method that achieves class-conditional coverage under some conditions over the learned clustering function."
                    }
                },
                "number": 10,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700360339362,
                "cdate": 1700360339362,
                "tmdate": 1700555692244,
                "mdate": 1700555692244,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "Spg4K2PN0c",
                "forum": "Dtxc7mlKRg",
                "replyto": "g0ANYAt5Ok",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "content": {
                    "comment": {
                        "value": "Q8: **If the nominated coverage $\\tilde \\alpha$  is larger than $\\alpha$, then why are the generated sets shorter?  Is it because this allows for the use of only the top-$k$ classes, which shortens the intervals?** \n\nA8: Yes, the additional calibration for the top-$k$ class improves efficiency (produced smaller prediction sets). The $k$-CCP algorithm adopts the double calibration mechanism to achieve improved trade-off between coverage and prediction set size. The key advantage of the additional calibration over rank is to exclude those data where their true labels are ranked beyond top-$\\widehat k(y)$ positions (i.e., poorly predicted data) in the calibration process, which in turn helps remove labels beyond top-$\\widehat k(y)$ positions in the testing process.\n\n\nQ9: **In the experiments, how were the hyperparameters chosen? Were the hyperparameters for the baselines chosen in a similar manner to that of the proposed method?**\n\nA9: See A4 above Q4. \n\nQ10: **Do existing works guarantee that their method of CCP outperforms the naive CCP method in terms of the size of the prediction set, or is this unique to this work?**\n\nA10: We add a baseline cluster-CP [R13] that achieves approximate class-conditional coverage (see Table1, 15, 16, and 17 in the updated paper) and find our $k$-CCP out performs it in efficiency. In [R13], the authors empirically showed improved efficiency, but did not provide theoretical analysis or guarantee. In contrast, our paper theoretically analyzes the factors ($\\sigma_y$ in Theorem 2) that reduce prediction set sizes of our $k$-CCP and also verifies in experiments in the last column of Figure 1 (we further verify these condition numbers on calibration data in Figure 24 of the updated paper).\n\nQ11: **Only compare the method to the simplest baseline of CCP.**\n\nA11: We added the following experimental results as requested by the reviewers.\n\n(1) Comparison with Cluster-CP [R13], an accepted NeurIPS-2023 paper, using both APS and RAPS scoring functions\n\n(2) Comparison experiments for MCP [R14], CCP [R16], [R17], Cluster-CP, and $k$-CCP with both APS and RAPS scoring functions\n\n(3) Comparison experiments with conformal training to show the synergistic benefits of CP methods including $k$-CCP using a better classifier\n\n(4) Ablation study for hyper-parameter $g$ with CCP, Cluster-CP, and $k$-CCP\n\n(5) Verification of $\\sigma_y$ on calibration data for different datasets\n\nInput space conditional CP methods pointed out by reviewers are not applicable for output space conditional CP (i.e., class-conditional CP). So we could not add such comparison experiments. We would like to point out that we included all the baselines used by the Cluster-CP paper which is accepted for publication at NeurIPS-2023.\n\nQ12: **An ablation study on how different values of $g$ affect the generated length of the sets.** \n\nA12: We add the ablation study to verify how hyper-parameter $g$ affects the performance of CCP, cluster-CP, and $k$-CCP. We use the under coverage ratio (UCR) and average prediction set size (APSS) as metrics (see Figure 2, 5, and 23 in the updated paper). According to the results, we observe that UCR and APSS of $k$-CCP are much smaller than CCP and cluster-CP with the same $g$ value. It verifies that $k$-CCP achieves a better trade-off between coverage and prediction set size. \n\n[R13] Ding, T., Angelopoulos, A. N., Bates, S., Jordan, M. I., & Tibshirani, R. J. (2023). Class-Conditional Conformal Prediction With Many Classes. arXiv preprint arXiv:2306.09335.\n\n[R14] Romano, Y., Sesia, M., & Candes, E. (2020). Classification with valid and adaptive coverage. Advances in Neural Information Processing Systems, 33, 3581-3591.\n\n[R15] Feldman, S., Bates, S., & Romano, Y. (2021). Improving conditional coverage via orthogonal quantile regression. Advances in neural information processing systems, 34, 2060-2071.\n\n[R16] Angelopoulos, A. N., & Bates, S. (2021). A gentle introduction to conformal prediction and distribution-free uncertainty quantification. arXiv preprint arXiv:2107.07511.\n\n[R17] Vladimir Vovk. Conditional validity of inductive conformal predictors. In Asian conference on machine learning, pages 475\u2013490. PMLR, 2012\n\n[R18] Vovk, V., Gammerman, A., & Shafer, G. (2005). Algorithmic learning in a random world (Vol. 29). New York: Springer.\n\n[R19] Sesia, M., & Romano, Y. (2021). Conformal prediction using conditional histograms. Advances in Neural Information Processing Systems, 34, 6304-6315."
                    }
                },
                "number": 11,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700360627011,
                "cdate": 1700360627011,
                "tmdate": 1700554368258,
                "mdate": 1700554368258,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "w1DVRnCyP5",
                "forum": "Dtxc7mlKRg",
                "replyto": "Spg4K2PN0c",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Reviewer_KjCS"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Reviewer_KjCS"
                ],
                "content": {
                    "title": {
                        "value": "Response"
                    },
                    "comment": {
                        "value": "I thank this author for their thoughtful response. \n\n$\\sigma_y$ is strictly less than $1$, so the Condition from Equation 12 should always be satisfied. Is this not true?\n\nI find that most of my weaknesses have been addressed. The only weakness I have is that there should still be more baselines. The notes on computability of $\\hat{k}$, the ablations of $g$, and the remarks on when the assumption from equation 12 is satisfied should be added to the camera-ready version. I would greatly appreciate more baselines from any of the works I mentioned, if possible. However, I feel comfortable increasing my score and believe the paper should be accepted."
                    }
                },
                "number": 13,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700441591702,
                "cdate": 1700441591702,
                "tmdate": 1700441591702,
                "mdate": 1700441591702,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "25qkzpE6Wb",
                "forum": "Dtxc7mlKRg",
                "replyto": "g0ANYAt5Ok",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "content": {
                    "comment": {
                        "value": "We thank you for your valuable and insightful review; we appreciate your increasing score.\n\nFQ1: **$\\sigma_y$ is strictly less than $1$, so the Condition from Equation 12 should always be satisfied. Is this not true?**\n\nA1: Yes. The empirical verification results show a stronger condition ($\\sigma_y$ is much smaller than 1 for all $y$, see the last column of Figure 1 and Figure 4 in our revised paper ), which ensures that the assumption in Theorem 2 (Equation (12) ) is always satisfied. Note that the reduction in prediction set size of $k$-CCP over CCP is proportional to how small the $\\sigma_y$ values are, which are classifier-dependent.\n\nFQ2: **The only weakness I have is that there should still be more baselines.**\n\nA2: We highlight that our revised paper includes a comprehensive comparison with most class-conditional conformal prediction algorithms, such as Cluster-CP [R23] and [R25] based CCP as baselines. For example, all baselines compared in [R23] are denoted as ''MCP\u2018\u2019 and ''CCP\u2018\u2019 in our paper. Note that [R23] is a NeurIPS-2023 accepted paper and our paper has all the baselines included in that paper. We note that papers mentioned by reviewers on conditional CP methods for input space [R26, R27]are not applicable to output space, i.e., the class-conditional setting. We updated the related work in the revised paper.\n\nFQ3: **The notes on computability of $\\widehat k$, the ablations of $g$, and the remarks on when the assumption from equation 12 is satisfied should be added to the camera-ready version.**\n\nA3: Thank you for your suggestions. We have added the computability of $\\widehat k$, the condition explanation of Equation (12), the ablation study of $g$, and the overall experiments with a new baseline [R23] and new score function [R21] in our updated paper. The revised paper reflects the camera copy version with all the changes.\n\n[R23] Ding, T., Angelopoulos, A. N., Bates, S., Jordan, M. I., & Tibshirani, R. J. (2023). Class-Conditional Conformal Prediction With Many Classes. arXiv preprint arXiv:2306.09335. Accepted for NeurIPS-2023.\n\n[R24] Angelopoulos, A., Bates, S., Malik, J., & Jordan, M. I. (2020). Uncertainty sets for image classifiers using conformal prediction. arXiv preprint arXiv:2009.14193.\n\n[R25] Stutz, D., Cemgil, A. T., & Doucet, A. (2021). Learning optimal conformal classifiers. arXiv preprint arXiv:2110.09192.\n\n[R26] Isaac Gibbs, John J Cherian, and Emmanuel J Cand`es. Conformal prediction with conditional guarantees. arXiv preprint arXiv:2305.12616, 2023\n\n[R27] Shai Feldman, Stephen Bates, and Yaniv Romano. Improving conditional coverage via orthogonal quantile regression. Advances in neural information processing systems, 34:2060\u20132071, 2021."
                    }
                },
                "number": 16,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700554424657,
                "cdate": 1700554424657,
                "tmdate": 1700555606938,
                "mdate": 1700555606938,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "dpDDbQMeG1",
            "forum": "Dtxc7mlKRg",
            "replyto": "Dtxc7mlKRg",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission8076/Reviewer_v9Qu"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission8076/Reviewer_v9Qu"
            ],
            "content": {
                "summary": {
                    "value": "The authors introduce a new approach, based on conformal prediction, to obtain prediction sets with a fixed set size in the setting of multiclass classification. While ordinary conformal prediction only gives control over the coverage of prediction sets by carefully choosing the significance level, this new method allows to choose the set size by selecting labels based on their rank statistics and appropriately modifying the significance level of the ordinary conformal predictor as to preserve the validity guarantee.\n\nIn a simple experiment they show how their method consistently outperforms standard marginal and class-conditional (Mondrian) conformal prediction on a selection of datasets for various class imbalance degrees."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "3 good"
                },
                "contribution": {
                    "value": "3 good"
                },
                "strengths": {
                    "value": "\u2022\tThe lack of efficiency guarantees in conformal prediction is a huge drawback for imbalanced data, the method introduced in this paper circumvents this problem.\n\n\u2022\tSince the authors give an explicit procedure on how to modify the initial significance level, the method is almost as easy to implement as standard conformal prediction methods."
                },
                "weaknesses": {
                    "value": "\u2022\tThe notations are sometimes a bit convoluted, e.g. in Proposition 1. Moreover, the terminology is sometimes somewhat non-standard. CCP from the paper is often called Mondrian conformal prediction in the literature, and CCP itself is also used as an abbreviation for cross-conformal prediction. \n\n\u2022\tA few minor errors:\n- Equation (6) hay label y on the left-hand side but uses c on the right-hand side.\n- In the proof of Lemma 1, in the equation with the Chernoff bound, a factor n is missing in the expression in the middle.\n\n\u2022\tProposition 1 feels a bit overly complex. Although technically sound, the content should be straightforward. E.g. if the coverage of two classes should average to 0.9 and one is larger than that, the other is going to be lower. This has also been discussed in a recent paper by Ding et al. \"Class-conditional conformal prediction with many classes\", Neurips 2023. \n\n\u2022\tI cannot see what Theorem 2 contributes. The theorem more or less assumes that the new method is better (the sigma factors), so obviously it will be better on average."
                },
                "questions": {
                    "value": "See above."
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "6: marginally above the acceptance threshold"
                },
                "confidence": {
                    "value": "4: You are confident in your assessment, but not absolutely certain. It is unlikely, but not impossible, that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work."
                },
                "code_of_conduct": {
                    "value": "Yes"
                },
                "first_time_reviewer": {
                    "value": "Yes",
                    "readers": [
                        "ICLR.cc/2024/Conference/Program_Chairs",
                        "ICLR.cc/2024/Conference/Submission8076/Senior_Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission8076/Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission8076/Reviewer_v9Qu"
                    ]
                }
            },
            "number": 3,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission8076/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698748277665,
            "cdate": 1698748277665,
            "tmdate": 1699636999875,
            "mdate": 1699636999875,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "XVAGjzcemA",
                "forum": "Dtxc7mlKRg",
                "replyto": "dpDDbQMeG1",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response For Reviewer v9Qu"
                    },
                    "comment": {
                        "value": "We thank the reviewer for their thoughtful comments and feedback.\n\nQ1: **The terminology is sometimes somewhat non-standard. CCP from the paper is often called Mondrian conformal prediction in the literature.**\n\nA1: Thank you for your suggestion, but our $k$-CCP is not a Mondrian conformal predictor. In fact, Mondrian conformal prediction (MCP) is a general procedure that encompasses many kinds of conditional conformal prediction [R11] [R12], including class conditional conformal prediction and group (attribute) conditional conformal prediction, etc. Our paper focuses on only class-conditional conformal prediction, instead of the general conditional coverage. Therefore, we use the terminology \u201cclass-conditional conformal prediction\u201d to represent the relevant algorithms.\n\nQ2: **Proposition 1 feels a bit overly complex. Although technically sound, the content should be straightforward. This has also been discussed in a recent paper by Ding et al. \"Class-conditional conformal prediction with many classes\", Neurips 2023**\n\nA2: Proposition 1 is a general result to show the ease of under-coverage for Marginal CP. Technically, we only use very mild assumptions in Equation (7) as the condition for the violation of class-conditional coverage. Although other literature may discuss the same observation, our Proposition 1 theoretically quantifies the gap of class-conditional coverage and importantly makes this quantity easily verifiable in experiments (See the first column of Figure 1 and 4).\n\nQ3: **What Theorem 2 contributes. The theorem more or less assumes that the new method is better (the sigma factors), so obviously it will be better on average.**\n\nA3: The contribution of Theorem 2 is to theoretically identify the source of reduced prediction set sizes by $k$-CCP, so that it enables verification in experimental results shown in Figure 1 (last column). We additionally verify it on calibration data in Figure 24 of the updated paper. We believe that Theorem 2 reveals this insight/knowledge and wraps up the key factors into the condition numbers $\\sigma_y$.\n\n\n\n[R11] Vovk, V., Gammerman, A., & Shafer, G. (2005). Algorithmic learning in a random world (Vol. 29). New York: Springer.\n\n[R12] Ding, T., Angelopoulos, A. N., Bates, S., Jordan, M. I., & Tibshirani, R. J. (2023). Class-Conditional Conformal Prediction With Many Classes. arXiv preprint arXiv:2306.09335."
                    }
                },
                "number": 9,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700360224423,
                "cdate": 1700360224423,
                "tmdate": 1700553974695,
                "mdate": 1700553974695,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "H2hcj4P1qm",
            "forum": "Dtxc7mlKRg",
            "replyto": "Dtxc7mlKRg",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission8076/Reviewer_RD2z"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission8076/Reviewer_RD2z"
            ],
            "content": {
                "summary": {
                    "value": "The paper theoretically proves that Marginal Conformal Prediction can result in over- or under-coverage for classes in imbalanced data settings. To address this, the authors propose the k-Class-Conditional Conformal Prediction (k-CCP) approach, which integrates inflated coverage with a calibrated rank threshold, derived from the top-k error of the classifier for each class. Supported by both theoretical proofs and experiments on various datasets, the authors shows k-CCP outperforms CCP on average prediction set size."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "3 good"
                },
                "contribution": {
                    "value": "2 fair"
                },
                "strengths": {
                    "value": "- The paper addresses the issue of imbalanced data under the conformal prediction framework, and provides a feasible way of optimizing class-specific coverage while achieving shorter prediction intervals. Both theoretical proofs and empirical evidence support the efficacy of the proposed method.\n- The k-CCP algorithm is a novel approach that combines the strengths of CCP with additional refinements to handle imbalanced data more effectively.\n- Overall, the paper is well-written and consistent."
                },
                "weaknesses": {
                    "value": "- The purposed method heavily relies on the ranking of candidate class labels by the classifier, which could be a limitation if the classifier's ranking is not reliable.\n- Chapter 3 appears somewhat redundant. Using an overall score for each class in conformal prediction (MCP) would lead to marginal coverage rather than class-specific coverage seems evident. Previous works by (Lei, 2014; Sadinle et al., 2019) studied overall coverage and class-specific coverage separately.\n- The empirical results could benefit from further enhancement (see questions below)."
                },
                "questions": {
                    "value": "- In Theorem 2, could assumption (10) be too strong to achieve? It suggests that kCCP algorithm should lead to a coverage that is less than or equal to the CCP and achieve a shorter length as a trade-off. Also, could you elaborate on how this assumption was validated?\n\n- I might have overlooked this detail, but how can we choose $k$ by hyper-parameter $g$ in general?\n\n- The Average Prediction Set Size (APSS) you presented takes the average prediction length evenly for each class. I wonder if you can present the comparison of the overall average prediction lengths. I'm curious if we will have a larger set-valued prediction for the ''majority'' classes."
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "5: marginally below the acceptance threshold"
                },
                "confidence": {
                    "value": "3: You are fairly confident in your assessment. It is possible that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work. Math/other details were not carefully checked."
                },
                "code_of_conduct": {
                    "value": "Yes"
                }
            },
            "number": 4,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission8076/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698834329562,
            "cdate": 1698834329562,
            "tmdate": 1699636999759,
            "mdate": 1699636999759,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "z6CVPQe401",
                "forum": "Dtxc7mlKRg",
                "replyto": "H2hcj4P1qm",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response For Reviewer RD2z"
                    },
                    "comment": {
                        "value": "We thank the reviewer for their thoughtful comments and feedback.\n\nQ1: **The purposed method heavily relies on the ranking of candidate class labels by the classifier, which could be a limitation if the classifier's ranking is not reliable.**\n\nA1: No, $k$-CCP does not make assumptions on the top-$k$ accuracy to configure (see Theorem 1 and Remark 2). \n\n$k$-CCP degenerates to CCP in the worst-case when the label rank threshold for each class is set to the total number of classes. Intuitively, the reduction in prediction set sizes from $k$-CCP over CCP depends on how small the label rank thresholds are which is classifier-dependent. If the top-$k$ accuracy of the classifier is good, then we will achieve significantly small prediction sets using $k$-CCP (Theorem 2 and condition numbers $\\sigma_y$). Our experimental results on four diverse datasets demonstrate that $k$-CCP significantly reduces prediction set size over CCP and Cluster-CP (NeurIPS-2023 paper).\n\n\n\nQ2: **Chapter 3 appears somewhat redundant. Using an overall score for each class in conformal prediction (MCP) would lead to marginal coverage rather than class-specific coverage seems evident. Previous works by (Lei, 2014; Sadinle et al., 2019) studied overall coverage and class-specific coverage separately.**\n\nA2: We do not use the fact that MCP does not guarantee class-conditional coverage as the only key motivation. Instead, we use its failure analysis to highlight the ease of under-coverage on imbalanced data (see the first column of Figure 1 for significant deviation of class-wise quantiles even for relatively balanced data where $\\rho = 0.5$). On the other hand, the existing CCP method guarantees the class-conditional coverage but produces large prediction sets. These two observations together motivate the need for efficient CP algorithms which provide class-conditional coverage with small prediction sets.\n\nQ3: **In Theorem 2, could assumption (10) (Equation (12) in our updated paper) be too strong to achieve?**\n\nA3: The assumption of condition numbers $\\sigma_y$ in Equation (12) is commonly satisfied and supported by empirical results (see Section 5.2, Figure 1, the last column with the standard training process). In addition, in Figure 24 of the updated paper, we also verify this assumption firmly holds on the calibration set.\n\nQ4: **How this assumption was validated?**\n\nA4: To verify the assumption in Equation (10), we directly estimate the empirical values of $\\sigma_y$ for each class label $y$ on testing data (Section 5.2, the last column of Figure 1). For fixed $y$, we go over all testing samples $X_{n+1}$ and calculate the frequencies of two events:\n(1) the joint event \u201cthe coverage of non-conformity scores and calibrated rank\u201d, i.e., $V(X_{n+1}, y) \\leq \\widehat Q_{1-\\tilde \\alpha}^{\\text{class}}$ with $\\tilde \\alpha \\leq \\alpha$\u201d and meanwhile the rank of $y$ stays in top-$\\widehat k(y)$, i.e., $r_f(X_{n+1}, y) \\leq \\widehat k(y)$\n\n(2) the event \u201cthe coverage of non-conformity scores\u201d, i.e., $V(X_{n+1}, y) \\leq \\widehat Q_{1-\\alpha}^{\\text{class}}$ with nominated mis-coverage $\\alpha$\u201d.\n\nAfter that, we compute the fraction of these two frequencies, to estimate $\\sigma_y$.\n\n\nQ5: **How can we choose $k$ by hyper-parameter $g$ in general?**\n\nA5: In Appendix C.2, we explained that we selected the value of $g$ from the interval $[0.1, 1]$ in increments of $0.05$ to find the minimal $g$ that $k$-CCP and CCP achieved the target class conditional coverage. We will move this explanation to the main text in the revised paper.\n\nQ6: **Present the comparison of the overall average prediction lengths.**\n\nA6: We report the overall average prediction lengths on the balanced testing set. \nBecause our goal is class-conditional coverage, the macro average prediction set size is more suitable for fair comparison. Additionally, we use a balanced calibration dataset, even though the training dataset itself is imbalanced. It means that the macro average prediction set size equals the micro average prediction set size, which is also adapted by another class conditional conformal prediction method [R9]."
                    }
                },
                "number": 7,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700360015277,
                "cdate": 1700360015277,
                "tmdate": 1700554670662,
                "mdate": 1700554670662,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "gidw73tiOX",
                "forum": "Dtxc7mlKRg",
                "replyto": "H2hcj4P1qm",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "content": {
                    "comment": {
                        "value": "Q7: **If we will have a larger set-valued prediction for the ''majority'' classes.**\n\nA7: We added new experiments to compare the average prediction set size of majority, medium, and minority groups in MCP, CCP, cluster_CP [R9], and  $k$-CCP (See Figure 21 with APS scoring function and Figure 22 with RAPS [R10] scoring function in Appendix H of the revised paper).  We select the top $1/4$ classes of the largest number of data to the majority group. Similarly, we assign the bottom $1/4$ classes of smallest number of data to the minority group and the remaining $1/2$ classes to the medium group. In conclusion, for the same CP method, we find that the group-wise average prediction set sizes do not differ too much, while the sizes generated by different CP methods can be large, e.g., $k$-CCP outperforms baselines significantly.\n\n[R9] Ding, T., Angelopoulos, A. N., Bates, S., Jordan, M. I., & Tibshirani, R. J. (2023). Class-Conditional Conformal Prediction With Many Classes. arXiv preprint arXiv:2306.09335.\n\n[R10] Angelopoulos, A., Bates, S., Malik, J., & Jordan, M. I. (2020). Uncertainty sets for image classifiers using conformal prediction. arXiv preprint arXiv:2009.14193."
                    }
                },
                "number": 8,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700360056748,
                "cdate": 1700360056748,
                "tmdate": 1700553911628,
                "mdate": 1700553911628,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "2J7BIfV6Ix",
                "forum": "Dtxc7mlKRg",
                "replyto": "H2hcj4P1qm",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Reviewer_RD2z"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Reviewer_RD2z"
                ],
                "content": {
                    "comment": {
                        "value": "Thank you for your detailed responses which I have carefully reviewed. While they haven't altered my initial assessment of the paper, I appreciate the clarity and effort put into addressing the concerns raised."
                    }
                },
                "number": 22,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700695079357,
                "cdate": 1700695079357,
                "tmdate": 1700695079357,
                "mdate": 1700695079357,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "LONDBpGni6",
            "forum": "Dtxc7mlKRg",
            "replyto": "Dtxc7mlKRg",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission8076/Reviewer_TQMX"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission8076/Reviewer_TQMX"
            ],
            "content": {
                "summary": {
                    "value": "The authors propose a method to construct prediction sets using conformal prediction and the top-k predictions of a classifier. More specifically they chose to include in the prediction sets labels that satisfy the following a) have a conformal score below an class conditional quantile for a higher coverage than the target one, and b) have a classifier score ranking below a chosen threshold.\nThe objective of the proposed method is to achieve class conditional coverage guarantees and smaller size of the prediction sets. The authors evaluate their method on several datasets against conformal prediction with marginal guarantees and class conditional conformal prediction."
                },
                "soundness": {
                    "value": "2 fair"
                },
                "presentation": {
                    "value": "1 poor"
                },
                "contribution": {
                    "value": "2 fair"
                },
                "strengths": {
                    "value": "Imbalanced datasets are a significant problem that can have catastrophic consequences in the performance of predictive ML models. In this context, studying the problem of conformal prediction and aiming at robust methods with rigorous coverage guarantees are of great interest.\n\nThe experimental evaluation is on several datasets assuming different scenarios on the class imbalance during training. \n\nThe authors provide the code for reproducibility."
                },
                "weaknesses": {
                    "value": "**Significance**\n\n\u201cOur proposed k-CCP algorithm (summarized in Algorithm 2) avoids scanning all class labels y \u2208 Y by leveraging good properties of the given classifier f in terms of its top-k accuracy.\u201d One of the advantages of conformal guarantees is that they do not depend on the classifier used to compute the prediction sets. Assumptions on the classifier make the method no longer applicable as a post-hoc procedure working with a black-box ML model. In addition,  in realistic scenarios it  may be hard to make valid assumptions on the top-k  accuracy of the classifier. Moreover, if a classifier is trained using an imbalanced dataset, one should expect the accuracy of the classifier to be higher for majority classes, which does not necessarily guarantee good performance on the top-$k$ accuracy.\n\nThe computation of $\\hat{k}$ depends on the hyper parameter $g$. One would expect that tuning such a hyper parameter would add a data and computation overhead. The authors do not elaborate on this overhead neither on the process of selecting  the hyper parameter as well as the implications that this process can have. Furthermore, it is not clear if the proposed $\\hat{k}$ will never be such that it violates the target coverage $1-\\alpha$. A definition of $\\hat{k}$ in theorem 1 as well as guarantees that the error terms in theorem 1 are small or can be small with high probability for that $\\hat{k}$  could strengthen the contribution.\n\nThe results of theorem 2 strongly depend on the assumption (10). This assumption seems to depend on the probability distributions that may be hard to safely evaluate and verify in practice without a significant data overhead. It would be very useful to provide insights, or data efficient method with which one could check if (10) is satisfied.\n\n**Novelty**\n\nIf the paper was the first attempt towards class conditional coverage, a failure analysis for the standard split conformal prediction algorithm, would make perhaps more sense. However, given that there are already other algorithms to address class conditional coverage, showing that MCP does not necessarily provide class-conditional guarantees does not seem as a strong motivation  for the current work.  Existing prior work [2] has already provide evidence that MCP does not satisfy class conditional guarantees. Besides MCP was never designed or claimed to achieve class conditional coverage.  \n\nGiven that in the experimental results k-CPP and CPP seem to perform very similarly in terms of conditional coverage, it seems that the main advantage of k-CPP is the reduced set size. However, there is no comparison with CPP using the RAPS method [1] that improves over APS. It would be also important to investigate (theoretically and/or experimentally) how the proposed method compares to other approaches with conditional guarantees such as [3], or other approaches to improve the size of the prediction sets [4]. Were there results on how the proposed approach advances over such works, would make the contribution much stronger.\n\n**Presentation/clarity**\n\nThe entire manuscript gives the reader the impression that it was written in a rush as, typos, grammatical errors and poor sentence structure appear very frequently.  These make the work cumbersome to read. Moreover, there seems to be quite some room fro improvement in terms of clarity, flow and cohesion. For example:\n*   In the abstract it is very unclear what the authors mean by \u201cinflated coverage and calibrated rank thresholds\u201d\n*   In the introduction in the 3rd paragraph in the middle  \u201cTo answer the main research question,\u201d  should follow right after the main research question for a nice flow\n*   In the last paragraph before contributions the way the authors are presenting the differences is quite confusing. Instead of stating the methods followed by CCP and then listing the methods of k-CCP, it would have been clearer to compare the two approaches point by point.   \n*  The three bullets in the contribution are hard to read. They lack of proper sentence structure, especially the lack of any articles make the reader struggling to follow. They look more like incomplete notes, than proper text.\n*  The definition of the top-k error for a class $c$ is confusing. $\\epsilon_c$ seems to depend both on the constants $c$ and $k$. Perhaps using $\\epsilon_{c}^{k}$ could make the definition clearer. \n*  In page 5, in the definition of the top-k error it the random variable $Z$ is not defined. Also, in the same paragraph it is not clear what is the distinction between $\\hat{k}(y)$ and $k(y)$. Also $\\hat{k}(y)$ is not formally defined the first time that it is introduced, which is confusing.\n*  It is not clear why $\\sigma_{y}$ is necessary in (10), as the denominator cancels out. One could directly state the condition in (10) using just the nominator of $\\sigma_{y}$.\n\nIn the experimental evaluation, in table 1 the results for the Food-101 datasets on the UCR are not highlighted for CPP method wherever it achieves the lowest UCR among the baselines.  \n \nThe under coverage indicator in the Under Coverage Ratio  assumes a fixed calibration set. However, conformal coverage guarantees on $1 - \\alpha$ are in expectation over the calibration set and the test sample. As a result the UCR definition appears incorrect. \n\n**Typos/Misc**\n\n1. Abstract, 1st line \u201cClassification tasks \u2026 arises\u201d \u2014> \u201cClassification tasks\u2026. arise\u201d\n2. Abstract, 8th line from the end, \u201cestimates class-specific non conformity score threshold, inflated coverage and calibrated rank threshold\u201d\u2014> , \u201cestimates class-specific non conformity score thresholds inflated coverage and calibrated rank thresholds\u201d\n2. Introduction, 2nd line of 1st paragraph, \u201cwith long tail distribution\u201d \u2014> \u201cwith long tail distributions\"\n3. \u201c\u2026minority classes are typically very important\u201d; that seems a bit as an over-generalization. Depending on the setting there might be minority classes that are not necessarily crucial. Yet, it is true that it can happen that the minority classes are very important. \u201c\u2026minority classes can be very important..\u201d might be a better phrasing.\n4. Introduction, first paragraph, one line before the  end \u201cimbalance data\u201d\u2014>  \u201cimbalanced data\u201d\n6. Introduction,  in the paragraph before the contributions : \u201c2) calibrated rank threshold for each class c.\u201d\u2014> \u201c2) a calibrated rank threshold for each class c.\u201c \n7. Introduction, contributions \u201cNovel CP algorithm for class-conditional coverage by calibrating conformity score and rank threshold pair for each class to exploit the top-k accuracy of the given classifier. \u201c \u2014> \u201cA novel CP\u2026calibrating conformity scores/ the conformity score\u201d. It is unclear what is a \"rank threshold pair? Would it be better perhaps to write \u201cby calibrating a pair of thresholds, one based on the conformity score, one based on the ranking of the score of the classifier\u201d? \n9. Introduction, contributions \u201cTheoretical analysis to demonstrate the failure of marginal CP, k-CCP guarantees class- conditional coverage, and k-CCP produces smaller prediction sets over the baseline CCP.\u201d\u2014> \u201cTheoretical analysis to demonstrate the failure of marginal CP, to prove class-conditional coverage guarantees of k-CCP, as well as to prove that k-CPP achieves to produce smaller prediction sets than CPP.\u201d\n10. Section 2, 1st paragraph 4th line \u201cWe consider imbalanced data setting\u201d \u2014> \u201cWe consider imbalanced data settings/ an imbalanced data setting\u201d \n11. Section 2, 1st paragraph 6th line \u201cthe soft classifier\u201d \u2014> \u201ca soft classifier\u201d \n12. Section 2, in paragraph Problem definition \u201cfor imbalanced data setting\u201d \u2014> \u201cfor imbalanced data settings\u201d\n13. Above (1) \u201cpupulation level\u201d \u2014> \u201cpopulation level\u201d\n14. Section 3, MCP paragraph line 3, \u201clarge value means that\u201d \u2014> \u201cif the non-conformity score is large, the new\u2026\u201d\n15. Section 3, MCP paragraph line 4 \u201cconforms less with calibration samples\u201d \u2014> \u201cconforms less to the calibration samples\u201d \n16. Section 3 Failure Analysis of MCP. \u201cdefine class-wise empirical quantile\u201d \u2014> \u201cdefine the class-wise empirical quantile\u201d \n17. Page 9 in paragraph above \u201cconformal prediction\u201d and above \u201csummary\u201d: \u201cfor imbalanced data setting\u201d \u2014> \u201cfor imbalanced data settings\u201d \n18. Page 9, conclusion \u201cOur theoretical and empirical analysis demonstrate that MCP algorithm achieves only marginal coverage can arbitrarily have over- or under-coverage on classes in practice\u201d \u2014> is an \u201cand\u201d missing between \u201ccoverage\u201d and \u201ccan\u201d?\n19. Page 9, conclusion \u201cthat estimates class-specific non-conformity score threshold\u201d \u2014> \u201cthat estimates class-specific non-conformity score thresholds\u201d\n20. Page 9, conclusion \u201ccalibrated rank\u201d is unclear.\n21. Page 9, conclusion \u201cwhich satisfy both class-specific threshold and calibrated rank to produce the prediction set, in contrast with CCP baseline that iterates all possible class labels with non-conformity score threshold only\u201d does not make sense.\n22. Page 9, conclusion \u201dk-CCP produce\u201d \u2014> \u201ck-CCP produces\u201d\n23 The table captions do not follow the ICRL author instructions.\n\n[1] Angelopoulos, A., Bates, S., Malik, J., & Jordan, M. I. (2020). Uncertainty sets for image classifiers using conformal prediction. arXiv preprint arXiv:2009.14193.\n\n[2] L\u00f6fstr\u00f6m, T., Bostr\u00f6m, H., Linusson, H., & Johansson, U. (2015). Bias reduction through conditional conformal prediction. Intelligent Data Analysis, 19(6), 1355-1375.\n\n[3] Gibbs, I., Cherian, J. J., & Cand\u00e8s, E. J. (2023). Conformal Prediction With Conditional Guarantees. arXiv preprint arXiv:2305.12616.\n\n[4] Stutz, D., Cemgil, A. T., & Doucet, A. (2021). Learning optimal conformal classifiers. arXiv preprint arXiv:2110.09192."
                },
                "questions": {
                    "value": "1.In the definition of $\\epsilon_{c}$ is the probability over the samples X and the classes Y? It might be helpful to clarify that in the problem definition. \n\n2. In eq. 1 the authors define their class-conditional coverage objective. This objective includes the coverage probability on a population level. However the authors do not specify if the probability  is both over the calibration set and the test set as it is for CP. It would be helpful to clearly state over what is the coverage probability in eq. 1\n \n3. Below eq 3. \u201cgood non-conformity scoring functions\u201d, this term is rather vague for non experts in conformal prediction. It would have been clear if the authors mention what is a good non-conformity scoring function, (e.g., one that results in small prediction sets). The comment applies for the next line \u201ceffective conformity score function\u201d. It is unclear what is effective, and if by effective, again the authors mean, resulting in smaller prediction set size."
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "3: reject, not good enough"
                },
                "confidence": {
                    "value": "4: You are confident in your assessment, but not absolutely certain. It is unlikely, but not impossible, that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work."
                },
                "code_of_conduct": {
                    "value": "Yes"
                },
                "first_time_reviewer": {
                    "value": "Yes",
                    "readers": [
                        "ICLR.cc/2024/Conference/Program_Chairs",
                        "ICLR.cc/2024/Conference/Submission8076/Senior_Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission8076/Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission8076/Reviewer_TQMX"
                    ]
                }
            },
            "number": 5,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission8076/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698844024978,
            "cdate": 1698844024978,
            "tmdate": 1699636999637,
            "mdate": 1699636999637,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "8RlaS8Pgir",
                "forum": "Dtxc7mlKRg",
                "replyto": "LONDBpGni6",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response For Reviewer TQMX"
                    },
                    "comment": {
                        "value": "We thank the reviewer for their thoughtful comments and feedback.\n\nQ1: **Assumptions on the classifier make the method no longer applicable as a post-hoc procedure working with a black-box ML model. In addition, in realistic scenarios it may be hard to make valid assumptions on the top-k accuracy of the classifier.**\n\nA1: No, $k$-CCP does not make assumptions on the top-$k$ accuracy to configure (see Theorem 1 and Remark 2). \n\n$k$-CCP degenerates to CCP in the worst-case when the label rank threshold for each class is set to the total number of classes. Intuitively, the reduction in prediction set sizes from $k$-CCP over CCP depends on how small the label rank thresholds are which is classifier-dependent. If the top-$k$ accuracy of the classifier is good, then we will achieve significantly small prediction sets using $k$-CCP (Theorem 2 and condition numbers $\\sigma_y$). Our experimental results on four diverse datasets demonstrate that $k$-CCP significantly reduces prediction set size over CCP and Cluster-CP (NeurIPS-2023 paper).\n\n\nQ2:  **The authors do not elaborate on this overhead neither on the process of selecting the hyper parameter as well as the implications that this process can have.**\n\nA2: Tuning the hyper-parameter $g$, similar to the model selection process for the other hyper-parameters like learning rate, only requires minor computational overhead. We select the $g$ from the interval [0.1, 1] to find the minimal $g$ that UCR of $k$-CCP and CCP equal to $0$. The detailed tuning approach is introduced in Remark 2 and Appendix C.2. Moreover, it is necessary for every CP method (including compared baselines) to tune the effective $1-\\alpha$ to ensure their UCR is smaller than a universal threshold close to $0$ in practical experiments (refer to our response to Q12 for why UCR has to be set near $0$ for all class-conditional CP methods uniformly). In other words, tuning this hyperparameter $g$ for $k$-CCP does not cost more overhead compared to baselines.\n\nQ3: **It is not clear if the proposed $\\hat k$ will never be such that it violates the target coverage $1\u2212\\alpha$.**\n\nA3: Under the standard i.i.d. condition, the estimated top-$k$ error concentrates around the population value. Although a concentration error occurs, it is in $O(1/\\sqrt{n})$ and can be merged with the tuning process of the hyper-parameter $g$ for estimating the quantile $Q_{1-\\alpha}^{\\text{class}}$ (their concentration errors are in the same order). As a result, the calibrated $\\widehat k(y)$ can be accurate enough to achieve the target class-conditional coverage as demonstrated by our strong empirical results across multiple benchmark datasets.\n\n\nQ4: **A definition of $\\hat k$ in theorem 1 as well as guarantees that the error terms in theorem 1 are small or can be small with high probability for that $\\hat k$ could strengthen the contribution.**\n\nA4: The notion of $\\widehat k(y)$ is given in Equation (9) and the paragraph before Theorem 1 provides this detail, which says ``can be any integer from $1$ to $C$\u2018\u2019. We do not determine the value of $\\widehat k(y)$ because we would like Theorem 1 to be general. In Remark 2, we give how to determine their values from the feasible set in a unified framework that meanwhile handles the constant $g$ from concentration errors.\nFor the top-$k$ errors ($\\epsilon_y$ in our paper), we do not assume they are very small. Instead, we select the value $k$ such that the corresponding top-$k$ error stays in a certain range, i.e., $\\leq \\alpha - g/\\sqrt{n_y}$. Among these feasible values, we pick the minimal one, i.e., determining $\\widehat k(y)$ as per Remark 2.\nAs for the concentration errors ($\\varepsilon_{n_y}$ in our paper), it depends on the number of class-wise calibration samples $n_y$.\n\n\nQ5: **This assumption seems to depend on the probability distributions that may be hard to safely evaluate and verify in practice without a significant data overhead. It would be very useful to provide insights, or data efficient method with which one could check if (10) is satisfied.**\n\nA5: Verifying if Equation 10 is satisfied in practice does not require significant computation/data overhead. The complexity for verification is $O(n C)$ (or improved to $O(n \\log(C))$ with binary search over classes from top-$1$ to top-$C$ for a large value $C$) with $n$ calibration samples (or $n$ testing samples if verification on testing data) and $C$ classes. Under the standard i.i.d. condition, the empirical estimates approximate population values in $O(1/\\sqrt{n})$.\n\nIn our verification experiments, it reduces to verifying if condition numbers $\\sigma_y \\leq 1$. If calibration data and testing data are i.i.d., then this verification experiment can also be done on the calibration set (See Section I, Figure 24 in our updated paper)."
                    }
                },
                "number": 3,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700359706984,
                "cdate": 1700359706984,
                "tmdate": 1700554657241,
                "mdate": 1700554657241,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "O89GG0rCn2",
                "forum": "Dtxc7mlKRg",
                "replyto": "LONDBpGni6",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "content": {
                    "comment": {
                        "value": "Q6: **Showing that MCP does not necessarily provide class-conditional guarantees does not seem as a strong motivation for the current work.**\n\nA6: We do not use the fact that MCP does not guarantee class-conditional coverage as the only key motivation. Instead, we use its failure analysis to highlight the ease of under-coverage on imbalanced data (see the first column of Figure 1 for significant deviation of class-wise quantiles even for relatively balanced data where $\\rho = 0.5$). On the other hand, the existing CCP method guarantees the class-conditional coverage but produces large prediction sets. These two observations together motivate the need for efficient CP algorithms which provide class-conditional coverage with small prediction sets.\n\n\nQ7: **Typos, grammatical errors and presentation in text and captions in the paper.**\n\nA7: Thank you for your careful corrections and suggestions. We will fix typos, grammatical errors, unclear presentation and complicated notations in text/tables/captions in the revised paper.\n\nQ8: **In page 5, in the definition of the top-k error it the random variable $Z$ is not defined. Also, in the same paragraph $\\hat k(y)$ is not formally defined and lack of the difference of $k(y)$ and $\\hat k(y)$.**\n\nA8: We highlight that  $\\widehat k(y)$ is formally defined in Equation (9) and the paragraph before Theorem 1. Later we introduce how to determine its value in Remark 2. However, we do not use $k(y)$ in our paper. \nFor the notation $Z$, we define it as $Z = (X, Y)$ as the features-label pair. We will include a clear definition of the random variable $Z$ in revision.\n\nQ9: **It is not clear why $\\sigma_y$ is necessary in (10), as the denominator cancels out.**\n \nA9: We use $\\sigma_y$ for a simpler notion of the condition number of the learned classifier. Our ablation study verifies the validity of Theorem 2 (see Section 5.2, the last column of Figure 1, $\\sigma_y$ is exactly the X-axis).\n\nQ10: **The under coverage indicator in the Under Coverage Ratio assumes a fixed calibration set. However, conformal coverage guarantees on $1\u2212\\alpha$ are in expectation over the calibration set and the test sample. As a result the UCR definition appears incorrect.**\n\nA10: We disagree that the UCR definition appears incorrect as a measure of under-coverage. Although CCP algorithms guarantee class-conditional coverage in expectation, we do not have access to the underlying distribution, so we can only measure the coverage empirically. As a result, we define UCR as the measure of under-coverage on a realized testing set, i.e., it is the percentage of classes on which under-coverage occurs. To better avoid the bias of the realized testing set, we also \u201crepeat experiments over 10 different random calibration-testing splits and report the average performance with standard deviation\u201d. Therefore, we believe UCR is a reasonable metric to measure the class-conditional coverage and provides a fair condition for efficiency (prediction set size) comparison over CP methods.\n\nQ11: **There is no comparison with CPP using the RAPS method [R4].**\n\nA11: We added the following experimental results as requested by the reviewers.\n\n(1) Comparison with Cluster-CP, an accepted NeurIPS-2023 paper, using both APS and RAPS scoring functions\n\n(2) Comparison experiments for MCP, CCP, Cluster-CP, and $k$-CCP with both APS and RAPS scoring functions\n\n(3) Comparison experiments with conformal training to show the synergistic benefits of CP methods including $k$-CCP using a better classifier\n\n(4) Ablation study for hyper-parameter $g$ with CCP, Cluster-CP, and $k$-CCP\n\n(5) Verification of $\\sigma_y$ on calibration data for different datasets\n\nInput space conditional CP methods pointed out by reviewers are not applicable for output space conditional CP (i.e., class-conditional CP). So we could not add such comparison experiments. We would like to point out that we included all the baselines used by the Cluster-CP paper which is accepted for publication at NeurIPS-2023."
                    }
                },
                "number": 4,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700359834579,
                "cdate": 1700359834579,
                "tmdate": 1700553674402,
                "mdate": 1700553674402,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "BaJj3Psxcq",
                "forum": "Dtxc7mlKRg",
                "replyto": "LONDBpGni6",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Authors"
                ],
                "content": {
                    "comment": {
                        "value": "Q12: **How the proposed method compares to other approaches with conditional guarantees such as [R5], or other approaches to improve the size of the prediction sets [R6].**\n\nA12: The target of [R5] is conditional coverage conditioned on the (input space) feature $X \\in G$, i.e., $X$ belongs to \u201cpre-specified groups\u201d. Instead, our paper focuses on the class-conditional coverage that is conditioned on (output space) each class, i.e., $Y = y$. We believe these two coverage guarantees are not comparable. \n[R6] proposed a training algorithm that aims to improve the size of prediction sets constructed by the subsequent CP algorithms. In contrast, our $k$-CCP is a model-agnostic (not a training algorithm) class-conditional CP algorithm with smaller prediction sets. Consequently, [R6] and our $k$-CCP are not comparable. However, we can still compare the efficiency of our $k$-CCP with other baselines based on the model trained by the learning algorithm in [R6].\nWe add these experimental results in Table 17 in the updated paper to compare $k$-CCP with CCP and cluster-CP [R6] based on two score functions (APS and RAPS [R4]) using the model trained by [R5]. Results still verify that our $k$-CCP significantly reduces the size of prediction sets.\n\n\n[R4] Angelopoulos, A., Bates, S., Malik, J., & Jordan, M. I. (2020). Uncertainty sets for image classifiers using conformal prediction. arXiv preprint arXiv:2009.14193.\n\n[R5] Gibbs, I., Cherian, J. J., & Cand\u00e8s, E. J. (2023). Conformal Prediction With Conditional Guarantees. arXiv preprint arXiv:2305.12616.\n\n[R6] Stutz, D., Cemgil, A. T., & Doucet, A. (2021). Learning optimal conformal classifiers. arXiv preprint arXiv:2110.09192.\n\n[R7] Ding, T., Angelopoulos, A. N., Bates, S., Jordan, M. I., & Tibshirani, R. J. (2023). Class-Conditional Conformal Prediction With Many Classes. arXiv preprint arXiv:2306.09335.\n\n[R8] Vladimir Vovk. Conditional validity of inductive conformal predictors. In Asian conference on machine learning, pages 475\u2013490. PMLR, 2012"
                    }
                },
                "number": 6,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700359909499,
                "cdate": 1700359909499,
                "tmdate": 1700553653022,
                "mdate": 1700553653022,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "9a4wArnNS4",
                "forum": "Dtxc7mlKRg",
                "replyto": "BaJj3Psxcq",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission8076/Reviewer_TQMX"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission8076/Reviewer_TQMX"
                ],
                "content": {
                    "comment": {
                        "value": "I would like to thank the authors for taking the time to make major revisions to improve the manuscript and to clarify several procedures and assumptions. The responses are greatly appreciated, but unfortunately have not fully addressed the initial concerns, thus I will have to retain my score. The revised version is quite improved and a resubmission would benefit the work.     \n\nRe: A1 it is clear that the proposed method does not rely on classifier assumptions to achieve validity, i.e., prediction sets that satisfy the class conditional target  coverage. However, from the paper, as well as A1, it is clear that the efficiency of the prediction sets, i.e., how small is their size, *does* depend on the assumption that the classifier has good top-k accuracy \u201cIf the top-k accuracy of the classifier is good, then we will achieve significantly small prediction sets using k-CCP\u201d. As achieving prediction sets of smaller size seems the main advantage of the proposed method, the above implies that having this advantage relies on the assumption that the classifier has good top-k accuracy. \n\nRe: A3 and A4 heuristically tuning $g$ and $\\hat{k}$ seems to strongly depend on the granularity of the range of the candidate $g$ values, as well as the size of the label space $C$. As a result high granularity as well as a very large label space would imply higher overhead; a limitation that should be explicit. In addition, even though the empirical results show that $\\hat{k}$ satisfies coverage in practice, it would be very interesting to provide theoretical guarantees that the proposed method in remark 2 will always (or with high probability) satisfy coverage.      \n\nRe: A5 estimating the probabilities in (12) in the revised version (that is (10) in the original version)  would require enough data for faithful estimates from each different class. In addition, even if with enough data, each estimate would be close to the true value with some probability. Assuming that this event holds *simultaneously*  for the probability estimates for all classes would require applying union bound or some type of multiplicity correction, which is not obvious from (12). Nevertheless, it would be useful in addition to the experimental results showing that (12) holds in practice, to provide theoretical results, showing guarantees that one could safely verify (12) using estimators from data in practice."
                    }
                },
                "number": 18,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission8076/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700673360905,
                "cdate": 1700673360905,
                "tmdate": 1700673360905,
                "mdate": 1700673360905,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    }
]
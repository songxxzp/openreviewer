[
    {
        "title": "Mamba: Linear-Time Sequence Modeling with Selective State Spaces"
    },
    {
        "review": {
            "id": "ZJCXkIMKQY",
            "forum": "AL1fq05o7H",
            "replyto": "AL1fq05o7H",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission4202/Reviewer_sf96"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission4202/Reviewer_sf96"
            ],
            "content": {
                "summary": {
                    "value": "The authors study the recent state-space models (SSM) family of efficient sequence architectures and address some of their challenges, related to the inability to perform content-based reasoning. The core contribution of the work is the addition of a selection method to the SSM architecture, which results in simple and scalable architecture, Mamba. Then they demonstrate the superiority of Mamba on standard language benchmarks, as well as DNA and audio modeling. The authors also contribute efficient implementation and benchmarking of Mamba on modern hardware."
                },
                "soundness": {
                    "value": "4 excellent"
                },
                "presentation": {
                    "value": "4 excellent"
                },
                "contribution": {
                    "value": "3 good"
                },
                "strengths": {
                    "value": "S1: The paper addresses very efficiently and effectively pressing problems in sequential modeling. \n\nS2: The authors have identified simple toy tasks, such as selective copying and associative recall, that enable them to make design choices which state-of-the-art impact on real-world data.\n\nS3: The connection to the role of gating mechanisms in RNNs is well-appreciated.\n\nS4: The empirical part of the paper is very thorough, and the results are strong."
                },
                "weaknesses": {
                    "value": "I do not identify any major weaknesses of the paper."
                },
                "questions": {
                    "value": "I am curious if we could build a better understanding of the selection mechanism that you propose. In Theorem 1 you link that mechanism to gating in RNNs as a special case. Is it possible to understand better the generalization through some discussion / qualitative examples?"
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "8: accept, good paper"
                },
                "confidence": {
                    "value": "4: You are confident in your assessment, but not absolutely certain. It is unlikely, but not impossible, that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work."
                },
                "code_of_conduct": {
                    "value": "Yes"
                }
            },
            "number": 1,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission4202/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698672946961,
            "cdate": 1698672946961,
            "tmdate": 1699636387094,
            "mdate": 1699636387094,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "cug6UefCdC",
                "forum": "AL1fq05o7H",
                "replyto": "ZJCXkIMKQY",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer sf96"
                    },
                    "comment": {
                        "value": "We are glad that the reviewer appreciates Mamba\u2019s relationship to gating mechanisms and finds the empirical results strong.\n\nRegarding the connection to gating: Theorem 1 establishes the relationship for a special case of $A$ and $B$. More broadly, **the $\\Delta$ parameter of SSMs plays the role of generalized gating**, and we view it as an elegant way to automatically induce gating (instead of the conventional heuristic explanation of gates).\n\nIn general, $\\Delta$ controls the balance between how much to focus or ignore the current input $x_t$.\nIt is analogous to the role of the gate $g_t$ in Theorem 1,\nmechanically, a large $\\Delta$ resets the state $h$ and focuses on the current input $x$,\nwhile a small $\\Delta$ persists the state and ignores the current input.\nSSMs (equation (1)-(2)) can be interpreted as a continuous system discretized by a timestep $\\Delta$,\nand in this context the intuition is that large $\\Delta \\to \\infty$ represents the system focusing on the current input for longer (thus ``selecting'' it and forgetting its current state)\nwhile a small $\\Delta \\to 0$ represents a transient input that is ignored.\n\nWe plan to include this discussion, as well as an extended discussion on the intuition and role of the other parameters of selective SSMs ($A$, $B$, and $C$), in an extended preprint that will be released together with the open source release of the model."
                    }
                },
                "number": 9,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission4202/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700730974581,
                "cdate": 1700730974581,
                "tmdate": 1700730974581,
                "mdate": 1700730974581,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "t7w5AlzJfq",
            "forum": "AL1fq05o7H",
            "replyto": "AL1fq05o7H",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission4202/Reviewer_5ZBk"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission4202/Reviewer_5ZBk"
            ],
            "content": {
                "summary": {
                    "value": "This paper upgrades S4 by making the token mixing matrix data-dependent and introduces the Mamba structure. On the other hand, although the use of FFT is not possible, the authors provide a linear algorithm for computation, resulting in linear computational complexity. The effectiveness of the proposed method is validated on multiple datasets."
                },
                "soundness": {
                    "value": "4 excellent"
                },
                "presentation": {
                    "value": "4 excellent"
                },
                "contribution": {
                    "value": "4 excellent"
                },
                "strengths": {
                    "value": "The paper is written in a clear and understandable manner, with a well-defined approach and simple yet effective improvement strategies."
                },
                "weaknesses": {
                    "value": "The paper lacks references to some relevant works, such as [1], [2], [3], [4] which discusses some Linear Attention methods, and [5], which is also a LongConv method. However, these references are completely absent in the paper. I suggest that the authors consider adding these citations to provide a more comprehensive review of related work.\n\n[1] Zhen Qin, Weixuan Sun, Hui Deng, Dongxu Li, Yunshen Wei, Baohong Lv, Junjie Yan, Lingpeng Kong, and Yiran Zhong. cosformer: Rethinking softmax in attention. In ICLR, 2022.\n\n[2] Efficient Attention via Control Variates, Lin Zheng, Jianbo Yuan, Chong Wang, and Lingpeng Kong In International Conference on Learning Representations (ICLR), 2023\n\n[3] Linear Complexity Randomized Self-attention Mechanism, Lin Zheng, Chong Wang, and Lingpeng Kong In International Conference on Machine Learning (ICML), 2022\n\n[4] Zhen Qin, Xiaodong Han, Weixuan Sun, Dongxu Li, Lingpeng Kong, Nick Barnes, and Yiran Zhong. The devil in linear transformer. In Proceedings of the 2022 Conference on Empirical Methods in Natural Language Processing, pages 7025\u20137041, Abu Dhabi, United Arab Emirates, Dec. 2022. Association for Computational Linguistics.\n\n[5] Zhen Qin, Xiaodong Han, Weixuan Sun, Bowen He, Dong Li, Dongxu Li, Yuchao Dai, Lingpeng Kong, and Yiran Zhong. Toeplitz neural network for sequence modeling. In The Eleventh International Conference on Learning Representations (ICLR), 2023."
                },
                "questions": {
                    "value": "1. Adding extrapolation experiments to the language model would be interesting.\n2. The ablation analysis in Table 6 should be more comprehensive, with a total of $2^3$ possible combinations. I suggest that the authors include the remaining two combinations.\n3. What's your setting of Scaling Law? Why is your ratio of token number and model size is the same as Chicilla's paper? I suppose the FLOPs of Transformers and SSMs would differ. Suppose the FLOPs of Transformers and SSMs would differ given the same amounts of total parameters, is this important to the final performance(accuracy)?\n4. How did you parameterize the first convolutional layer in the Mamba-Block.\n5. Providing more detailed implementation, such as offering core code, is very helpful."
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "8: accept, good paper"
                },
                "confidence": {
                    "value": "5: You are absolutely certain about your assessment. You are very familiar with the related work and checked the math/other details carefully."
                },
                "code_of_conduct": {
                    "value": "Yes"
                },
                "first_time_reviewer": {
                    "readers": [
                        "ICLR.cc/2024/Conference/Program_Chairs",
                        "ICLR.cc/2024/Conference/Submission4202/Senior_Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission4202/Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission4202/Reviewer_5ZBk"
                    ]
                }
            },
            "number": 2,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission4202/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698822175127,
            "cdate": 1698822175127,
            "tmdate": 1699849199041,
            "mdate": 1699849199041,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "NFL50EDEFU",
                "forum": "AL1fq05o7H",
                "replyto": "t7w5AlzJfq",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer 5ZBk"
                    },
                    "comment": {
                        "value": "We are glad the reviewer found the ideas in the paper simple, compelling, and clear. \n\n> Citations and related work\n\nWe appreciate the reviewer\u2019s suggestions for related work, which are all very related and appropriate. We have included all of them (and more linear attention variants) such as RFA, cosFormer, Performer, TransNormer, RAFA, and TNN in the extended related work.\n\n\n> Adding extrapolation experiments to the language model would be interesting.\n\nOur original submission includes length extrapolation results for the Induction Heads task, which is hypothesized to be deeply related to generalization abilities of language models [Anth]. In Figure 3 we show that Mamba can extrapolate from sequences of length 256 to length 1000000, while no other model (including Attention with variants of relative positional embeddings) extrapolate beyond length 512.\n\nIn the shared response, we include new results on measuring the length extrapolation abilities of Mamba compared to a standard Transformer.\n\n\n> The ablation analysis in Table 6 should be more comprehensive, with a total of $2^3$\n possible combinations. I suggest that the authors include the remaining two combinations.\n\nWe chose to exclude some partial combinations for the sake of clarity. This table includes the full ablations.\n\n| Selective $\\Delta$ | Selective $B$ | Selective $C$ | Perplexity |\n|--------------------|---------------|---------------|------------|\n|                    |               |               | 10.93      |\n|                    | +             |               | 10.15      |\n|                    |               | +             | 9.98       |\n| +                  |               |               | 9.81       |\n|                    | +             | +             | 9.49       |\n| +                  | +             |               | 9.21       |\n| +                  |               | +             | 9.07       |\n| +                  | +             | +             | 8.71       |\n\n\n\n> What's your setting of Scaling Law? Why is your ratio of token number and model size is the same as Chicilla's paper? I suppose the FLOPs of Transformers and SSMs would differ. Suppose the FLOPs of Transformers and SSMs would differ given the same amounts of total parameters, is this important to the final performance(accuracy)?\n\nThe FLOPs of Transformers and SSMs do not differ significantly at shorter sequence lengths (e.g. length 2048), and we believe that the standard Chinchilla scaling laws should apply. As shown in the difference between Figure 4 (Left) and 4 (Right), the FLOPs of Transformers vs. SSMs do differ at longer sequence lengths. It would be very interesting for future work to explore whether SSMs have different scaling laws especially with differing context lengths.\n\n> How did you parameterize the first convolutional layer in the Mamba-Block.\n\nWe use a standard local (causal) convolution of width 4. It is a depthwise convolution, i.e. operates independently per channel. This follows similar architecture design in H3, Hyena, and RWKV.\n\n> Providing more detailed implementation, such as offering core code, is very helpful.\n\nAs mentioned in the shared response, we are planning to release all code and pretrained models for the community."
                    }
                },
                "number": 8,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission4202/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700730930851,
                "cdate": 1700730930851,
                "tmdate": 1700730930851,
                "mdate": 1700730930851,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "bq8XeiBhwY",
            "forum": "AL1fq05o7H",
            "replyto": "AL1fq05o7H",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission4202/Reviewer_iEaX"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission4202/Reviewer_iEaX"
            ],
            "content": {
                "summary": {
                    "value": "The paper proposes a new class of selective state space models (SSMs) for sequence modeling that achieves Transformer-quality performance while scaling linearly in sequence length. The paper addresses the key problem in SSMs for selecting data by selecting particular inputs. The paper presents a hardware-aware algorithm that computes the model recurrently with a scan instead of convolution, avoiding materializing the expanded state to reduce memory usage. This results in faster computation than previous methods.\n\nThe paper simplifies prior deep sequence model architectures into a homogeneous architecture which is called as Mamba, incorporating the selective SSMs. Mamba enjoys fast inference, linear scaling, and improved performance on long sequences.\n\nIn the results the authors show that  Mamba achieves state of the art on synthetic tasks, audio/genomics modeling, and language modeling and outperforms Transformers of the same size on language modeling in both pretraining and downstream tasks.\n\nThe results suggest selective SSMs and the Mamba architecture could be a strong candidate for a general sequence model backbone for foundation models across modalities. The paper demonstrates the potential for linear-time models to match or exceed the performance of quadratic Transformers."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "3 good"
                },
                "contribution": {
                    "value": "3 good"
                },
                "strengths": {
                    "value": "+ A key limitation of prior SSMs is the inability to efficiently select data in an input-dependent manner. The paper introduces a key mechanism by parameterizing the SSM parameters based on the input, allowing the model to filter out irrelevant information and remember relevant information indefinitely.\n+ The results as compared to Pythia, and Transforms on many benchmarks are impressive."
                },
                "weaknesses": {
                    "value": "- The model still has a quadratic memory requirement during training like Transformers."
                },
                "questions": {
                    "value": "1) Have you evaluated scaling behavior beyond 1.4B parameters? How does it compare to Transformers at 10B scales?\n\n2) The input selection mechanism introduces additional hyper parameters. How sensitive are the results to hyperparameters like the projection rank?"
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "6: marginally above the acceptance threshold"
                },
                "confidence": {
                    "value": "2: You are willing to defend your assessment, but it is quite likely that you did not understand the central parts of the submission or that you are unfamiliar with some pieces of related work. Math/other details were not carefully checked."
                },
                "code_of_conduct": {
                    "value": "Yes"
                }
            },
            "number": 3,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission4202/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1699073663018,
            "cdate": 1699073663018,
            "tmdate": 1699636386944,
            "mdate": 1699636386944,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "LDqI8YxDeZ",
                "forum": "AL1fq05o7H",
                "replyto": "bq8XeiBhwY",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Review iEaX"
                    },
                    "comment": {
                        "value": "We appreciate the reviewer\u2019s close reading of the paper and that the reviewer found our results compelling. We respond to the reviewer\u2019s questions below.\n\n> The model still has a quadratic memory requirement during training like Transformers.\n\nWe would like to clarify that Mamba\u2019s memory requirement scales linearly in sequence length; the memory bottleneck is simply the size of the activation tensors. This is true of most deep sequence models, including Transformers (when using an optimized implementation such as FlashAttention). Mamba is in fact very memory efficient; we have included additional comparisons in Appendix F.5 (see response 4/4 to Reviewer du8a for numbers).\n\n> Have you evaluated scaling behavior beyond 1.4B parameters? How does it compare to Transformers at 10B scales?\n\nWe have managed to scale Mamba to the next standard model size of 2.7-2.8B parameters. Results are shown in the general response; it continues to strongly outperform open-source Transformers of the same size, and match Transformers of the next larger size (7B parameters).\n\n> The input selection mechanism introduces additional hyper parameters. How sensitive are the results to hyperparameters like the projection rank?\n\nThis is an excellent question; many new models come with new hyperparameters that must be tuned. Mamba has a few main axes of variation: \n* The projection rank $R$, as the reviewer noted\n* The state size $N$; larger states can perform better but slow down the model\n* Prior works on SSMs have had many variants of the initialization.\n\nAblations for all of these have been included in the original submission, Tables 7, 8, and 9. We see that increasing $R$ and $N$ both offer small improvements for a modest increase in parameters; however, they do not offer a significant performance difference. In fact, **all our experiments did no tuning on any of these hyperparameters** (fixing $R$ to be a constant fraction $1/16$ of the model dimension; fixing $N=16$; and fixing the initialization). We strongly believe that Mamba can be a promising **drop-in replacement** for attention in general foundation models."
                    }
                },
                "number": 7,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission4202/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700730816628,
                "cdate": 1700730816628,
                "tmdate": 1700730816628,
                "mdate": 1700730816628,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "eIarHE3vGs",
            "forum": "AL1fq05o7H",
            "replyto": "AL1fq05o7H",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission4202/Reviewer_du8a"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission4202/Reviewer_du8a"
            ],
            "content": {
                "summary": {
                    "value": "This paper proposes Mamba, which is a linear-time sequence model with selective state spaces. The authors propose to modify conventional state space models (SSMs) such that the modified models are input-dependent. The authors further propose engineering techniques for performance optimization. Experiments are conducted to demonstrate the effectiveness of the proposed method. In particular, several flavors of pre-trained models are provided."
                },
                "soundness": {
                    "value": "2 fair"
                },
                "presentation": {
                    "value": "3 good"
                },
                "contribution": {
                    "value": "2 fair"
                },
                "strengths": {
                    "value": "* The proposed Mamba method includes a simple modification to the conventional SSM model: add additional models to make SSM models dependent on the inputs. SSMs are known for their computational difficulties, and the authors address this issue by several performance optimization techniques.\n\n* The authors pre-train several variants of Mamba, ranging from 130M parameters to 1.4B parameters. These pre-trained models show performance improvements compared with the baselines in the paper."
                },
                "weaknesses": {
                    "value": "Concerns about model design:\n\n* The motivation of Mamba is to address the drawbacks of recurrent models while improving the efficiency of attention-based models. There are many works following the same direction: S4-diagonal [1], SGConv [2], MEGA [3], SPADE [4], and many efficient Transformer models (e.g., [5]). All of these models achieve near linear complexity, and the authors need to compare Mamba with these works in terms of both model performance and efficiency. For model performance, some simple experiments such as language modeling on Wikitext-103 should suffice.\n\n* Many attention-based Transformer models show length generalization ability, i.e., models can be trained on a shorter sequence length and tested on a longer sequence length. Some examples include relative positional encoding (T5) and Alibi [6]. Because SSMs are in general sequential, does Mamba have this length generalization ability?\n\n\nConcerns about experiments:\n\n* The authors need to compare with stronger baselines. The authors acknowledge that H3 was used as a motivation for the model architecture. However, they did not compare with H3 in the experiments. From Table 4 in [7], ppl of H3 is 8.8 (125M), 7.1 (355M), and 6.0 (1.3B) on the Pile dataset, which are considerably better than Mamba. The authors need to show comparisons with H3.\n\n* For the pre-trained models, the authors only show results on zero-shot inference. This setting is quite limited and the results cannot support the effectiveness of Mamba well. I suggest the authors run more long-sequence experiments such as document summarization, where the input sequence is naturally long (e.g., the average sequence length of the arXiv dataset is greater than 8k).\n\n* One of the main contributions that the authors claim is long sequence modeling. The authors should compare with more baselines on LRA (Long Range Arena), which is essentially the standard benchmark for long sequence understanding.\n\n* Memory benchmarking is missing. Even though Section 4.5 is titled \u201cspeed and memory benchmark\u201d, only speed comparisons are presented. Also, the authors should provide more detailed setups of Figure 8 left, e.g., model layers, model sizes, details of the convolution, etc. Could the authors provide some intuitions why FlashAttention is the slowest when the sequence length is very large (Figure 8 left)?\n\n[1] https://arxiv.org/pdf/2203.14343.pdf \\\n[2] https://arxiv.org/pdf/2210.09298.pdf \\\n[3] https://arxiv.org/pdf/2209.10655.pdf \\\n[4] https://arxiv.org/pdf/2212.08136.pdf \\\n[5] https://arxiv.org/pdf/2202.10447.pdf \\\n[6] https://arxiv.org/pdf/2108.12409.pdf \\\n[7] https://arxiv.org/pdf/2212.14052.pdf"
                },
                "questions": {
                    "value": "See above"
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "3: reject, not good enough"
                },
                "confidence": {
                    "value": "5: You are absolutely certain about your assessment. You are very familiar with the related work and checked the math/other details carefully."
                },
                "code_of_conduct": {
                    "value": "Yes"
                }
            },
            "number": 4,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission4202/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1699240330960,
            "cdate": 1699240330960,
            "tmdate": 1699636386876,
            "mdate": 1699636386876,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "f0OdihHLvW",
                "forum": "AL1fq05o7H",
                "replyto": "eIarHE3vGs",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer du8a (1/4): Main Contributions"
                    },
                    "comment": {
                        "value": "We greatly appreciate the reviewer\u2019s feedback and suggestions. We would like to first address the reviewer\u2019s main high-level concerns, and then respond to each detailed point individually.\n\nThe reviewer\u2019s **main concerns are about our baselines and benchmarks, with suggestions to compare against a broader range of attention-free or hybrid models on small-scale benchmarks** such as WikiText-103 and Long Range Arena. We would like to reiterate the main point of our new model as stated in the Introduction of the original submission:\n\n> We propose a new class of selective state space models, that improves on prior work on several axes to achieve the **modeling power of Transformers** while **scaling linearly in sequence length**.\n\nWe would like to note that almost all of the reviewer\u2019s suggested baselines are either:\n* **Already included in our baselines**: For example, S4D, DSS [1], and SGConv [2] are special cases of linear time-invariant (LTI) models that are nearly identical and perform very similarly to S4 and Hyena, two of our main baselines. Similarly, H3 [7] as well as Hyena are some of our main comparisons for language modeling (Figure 4).\n* **Not Transformer quality, or not linear-time**: A central thesis of our paper is that prior linear-time models (which are almost all LTI) *do not* match the performance of Transformers on information-dense data such as language. Indeed, models such as SGConv [2], MEGA [3] , and SPADE [4] explicitly use *hybrid models incorporating quadratic attention* to achieve their results on WikiText-103 (which are still worse than ours; see new results below). If the attention is removed, all of these models become LTI state-space models like the above and would perform similarly to S4 (significantly worse than Mamba/S6).\n\nIn the detailed response below, we expand on comparisons on WikiText-103 for all the above suggested models and many more. Nevertheless, we would like to emphasize that **our original submission has taken care to compare against the most modern and well-known subquadratic models that have been evaluated on large-scale pretraining** such as Hyena, RWKV, and RetNet.\n\n\nAdditionally, the Introduction states:\n\n> We empirically validate Mamba\u2019s potential as a general sequence **foundation model backbone**, in **both pretraining quality and domain-specific task performance**, on several types of modalities and settings.\n\nFoundation modeling \u2013 e.g. demonstrating **scaling abilities on large-scale pretraining data** \u2013 has become a fundamental paradigm in modern machine learning that is arguably more important than individual benchmarks. While small-scale benchmarks such as WikiText-103 (around 100M tokens) and Long Range Arena (LRA) have been popular for demonstrating the *potential* of new models such as SSMs, our work deliberately moves beyond these toward showing that SSMs \u2013 with our new contributions \u2013 can actually be effective at scale (e.g. on the Pile dataset - 300B tokens - 3000x the size of WikiText-103)."
                    }
                },
                "number": 3,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission4202/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700729707838,
                "cdate": 1700729707838,
                "tmdate": 1700731038596,
                "mdate": 1700731038596,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "UpOemR7oyX",
                "forum": "AL1fq05o7H",
                "replyto": "eIarHE3vGs",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer du8a (2/4): Baselines and WikiText-103"
                    },
                    "comment": {
                        "value": "> The motivation of Mamba is to address the drawbacks of recurrent models while improving the efficiency of attention-based models. There are many works following the same direction: S4-diagonal [1], SGConv [2], MEGA [3], SPADE [4], and many efficient Transformer models (e.g., [5]). All of these models achieve near linear complexity, and the authors need to compare Mamba with these works in terms of both model performance and efficiency. For model performance, some simple experiments such as language modeling on Wikitext-103 should suffice.\n\nAs stated in the shared response, we deliberately focused on the perplexity of larger-scale pretraining rather than small-scale benchmarks. Nevertheless, **Mamba strongly outperforms all suggested models and many more on WikiText-103**, as one might expect from our general results on language.\n\nFirst, we compare Mamba in the exact same setting as the Hyena paper [Poli, Table 4.3]. Beyond their reported numbers, we tune our own strong Transformer baseline. We then swap out the model for Mamba, which improves over our Transformer by 1.7 ppl and the original baseline Transformer by **2.3 ppl**.\n\n\n| Model (125M)   | WikiText-103 ppl | $\\Delta$ to Transf. |\n|----------------|------------------|-----|\n| Transformer    | 18.6             | 0.0 |\n| Hybrid H3      | 18.5             | -0.1 |\n| Performer      | 26.8             | 8.2 |\n| Reformer       | 25.6             | 7.0 |\n| AFT-conv       | 28.2             | 9.6 |\n| Linear Attn.   | 25.6             | 7.0 |\n| Hyena          | 18.5             | -0.1 |\n| Transf. (ours) | 18.0             | -0.6 |\n| **Mamba** (ours) | **16.3**         | **-2.3** |\n\nTherefore all of these subquadratic architectures do not improve over a comparable Transformer baseline. Moreover, our own Transformer baseline (18.0 ppl) above is stronger than that of prior work, and our Mamba model (*without tuning*) is even significantly better (16.3 ppl), all in the same setting.\n\nNext, we show results from several of the reviewer\u2019s suggested baselines [2,3,4] as reported by their original papers.\nBecause these results were obtained in potentially different codebases and training setups, we also report each paper\u2019s own Transformer baseline as well as the improvement.\n\n|Model             |WikiText-103 ppl  | Transformer ppl | $\\Delta$ |\n|------------------|------------------|------|-------|\n|SGConv + Attn [2] | 18.70            | 18.3 | 0.40  |\n|MEGA [3]          | 18.07            | 18.3 | -0.23 |\n|SPADE [4]         | 18.5             | 18.8 | -0.3  |\n\nThe improvements of these methods are all small (up to -0.3 ppl) compared to our results above (-2.3 ppl). Additionally, **all three of these methods are not linear-time**: they are hybrid models explicitly using quadratic attention. Without attention, these methods are *S4-based LTI* models that do not perform well on language, which is the main thesis of our paper.\n\nFinally, we analyze the reviewer\u2019s last suggested baseline FLASH [5]. While [5] does not report WikiText-103, we found that the recent preprint [Qin] performs controlled comparisons of a wide range of models including FLASH. Their results [Qin, Table 1] are reproduced here.\n\n| Model (44M)      | WikiText-103 ppl | $\\Delta$ to Transf. |\n|---------------   |---------         |---------------------|\n| **Transformer**  | 24.78            | 0.0                 |\n| FLASH            | 26.70            | 1.92                |\n| Linear Attn.     | 28.05            | 3.27                |\n| Performer        | 63.16            | 38.38               |\n| cosFormer        | 27.06            | 2.28                |\n| gMLP             | 29.13            | 4.35                |\n| Syn(D)           | 32.43            | 7.65                |\n| S4               | 39.66            | 14.88               |\n| DSS              | 41.07            | 16.29               |\n| GSS              | 30.74            | 5.96                |\n| RWKV             | 25.07            | 0.29                |\n| LRU              | 31.12            | 6.34                |\n| TNN              | 24.67            | -0.11               |\n| HGRN             | 24.82            | 0.04                |\n\nConsistent with the rest of these results and the main thesis of our paper, **every other existing subquadratic architecture does not improve over the basic Transformer**.\n\n[Poli] \u201cHyena Hierarchy: Towards Larger Convolutional Language Models.\u201d https://arxiv.org/abs/2302.10866\n\n[Qin] \u201cHierarchically Gated Recurrent Neural Network for Sequence Modeling.\u201d https://arxiv.org/abs/2311.04823"
                    }
                },
                "number": 4,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission4202/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700730214241,
                "cdate": 1700730214241,
                "tmdate": 1700731028256,
                "mdate": 1700731028256,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "Ho2NSra71h",
                "forum": "AL1fq05o7H",
                "replyto": "eIarHE3vGs",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer du8a (3/4): Other Questions"
                    },
                    "comment": {
                        "value": "> Many attention-based Transformer models show length generalization ability, i.e., models can be trained on a shorter sequence length and tested on a longer sequence length. Some examples include relative positional encoding (T5) and Alibi [6]. Because SSMs are in general sequential, does Mamba have this length generalization ability?\n\nOur original submission includes length extrapolation results for the Induction Heads task, which is hypothesized to be deeply related to generalization abilities of language models [Anth]. In Figure 3 we show that Mamba can extrapolate from sequences of length 256 to length 1000000, while no other model (including Attention with variants of relative positional embeddings) extrapolate beyond length 512.\n\nIn the shared response, we include new results on measuring the length extrapolation abilities of Mamba compared to a standard Transformer.\n\n[Anth] \u201c\u200b\u200bIn-context Learning and Induction Heads.\u201d https://transformer-circuits.pub/2022/in-context-learning-and-induction-heads/index.html\n\n> The authors need to compare with stronger baselines. The authors acknowledge that H3 was used as a motivation for the model architecture. **However, they did not compare with H3 in the experiments.** From Table 4 in [7], ppl of H3 is 8.8 (125M), 7.1 (355M), and 6.0 (1.3B) on the Pile dataset, which are considerably better than Mamba. The authors need to show comparisons with H3.\n\n**H3 is one of our main baselines, and is featured prominently in almost all results in the paper**:\n* The synthetic tasks, Selective Copying (Table 1) and Induction Heads (Figure 3).\n* For Chinchilla scaling laws (Figure 4), we used a much stronger version of H3 that we call H3++ (details in Appendix F.2.1).\n* For genomics, we compare against Hyena (Figure 5), which is the successor of H3.\n* We have since downloaded the pretrained H3 models from [7] and ran the suite of evaluations (see shared response).\n\nThe reviewer mentions that the reported perplexity numbers from [7] are better than ours. However, as mentioned in the caption of our Table 2, **perplexity scores are only comparable when trained with the same tokenizer**. The H3 paper used the GPT2 tokenizer and is not comparable to ours which uses the now-standard NeoX tokenizer. Instead, the downstream evaluations are directly comparable, where Mamba performs significantly better than H3.\n\n> For the pre-trained models, the authors only show results on zero-shot inference. This setting is quite limited and the results cannot support the effectiveness of Mamba well. I suggest the authors run more long-sequence experiments such as document summarization, where the input sequence is naturally long (e.g., the average sequence length of the arXiv dataset is greater than 8k).\n\n**We agree that the reviewer\u2019s suggestion is a great idea**, and in fact are planning to pursue such long-context applications in follow-up work. Unfortunately, these evaluations require an extensive fine-tuning pipeline in a *non-autoregressive* setting which fall beyond the scope of this paper; however, we strongly believe that Mamba will be effective in such settings."
                    }
                },
                "number": 5,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission4202/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700730619681,
                "cdate": 1700730619681,
                "tmdate": 1700730619681,
                "mdate": 1700730619681,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "T6WJZb30sz",
                "forum": "AL1fq05o7H",
                "replyto": "eIarHE3vGs",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission4202/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer du8a (4/4): Other Questions"
                    },
                    "comment": {
                        "value": "> One of the main contributions that the authors claim is long sequence modeling. The authors should compare with more baselines on LRA (Long Range Arena), which is essentially the standard benchmark for long sequence understanding.\n\nAs elaborated in the first part of our response, in this paper we have deliberately focused on more impactful settings than small benchmarks such as LRA. We offer several additional points of justification:\n* Our emphasis on the importance of pretraining is underscored by recent works such as [Amos], which indicate that *Transformers are competitive with state-of-the-art SSM models on LRA when allowed pretraining*.  This supports our claim that small-scale train-from-scratch benchmarks such as LRA may not be the most appropriate for measuring the quality of new **foundation model architectures at scale**, where thus far only Transformers have been effective.\n* **LRA is not actually long-range compared to our selection of tasks**. Our shortest-range task is standard Language Modeling (Figure 4), for which we have sequences of length 8192, which is already longer than (or on the order of magnitude of all LRA tasks). On the other hand, we have multiple settings (induction heads, genomics, and audio) involving sequences of length >1000000.\n\n[Amos] \u201cNever Train from Scratch: Fair Comparison of Long-Sequence Models Requires Data-Driven Priors\u201d. https://arxiv.org/abs/2310.02980\n\n> Memory benchmarking is missing. Even though Section 4.5 is titled \u201cspeed and memory benchmark\u201d, only speed comparisons are presented.\n\nThe memory usage is simply the size of the activation tensors, as with most deep sequence models (including FlashAttention). Mamba is in fact very memory efficient; we have included additional measurements of the training memory requirements of 125M models on 1 A100 80GB GPU. Each batch consists of sequences of length 2048. We compare to *the most memory-efficient Transformer implementation we are aware of* (with kernel fusion from torch.compile and with FlashAttention-2).\n\n| Batch size | Transformer (w/ FlashAttention-2) | Mamba  |\n|------------|-----------------------------------|--------|\n|          1 | 4.6GB                             | 4.8GB  |\n|          2 | 5.2GB                             | 5.8GB  |\n|          4 | 6.9GB                             | 7.3GB  |\n|          8 | 11.5GB                            | 12.3GB |\n|         16 | 20.7GB                            | 23.1GB |\n|         32 | 34.5GB                            | 38.2GB |\n\nMamba's memory requirement is comparable to a similar-sized Transformer with an extremely optimized implementation, and we expect further improvement in Mamba's memory footprint in the future.\nWe have added this Table to Appendix F.5.\n\n>  Also, the authors should provide more detailed setups of Figure 8 left, e.g., model layers, model sizes, details of the convolution, etc. \n\n**These details have been reported in the original submission.** The main body directs to Appendix F.5, which includes these details:\n* These measure only the core operation (scan, convolution, attention), not the full block (e.g. do not include the QKV projections of attention). There is no concept of layers\n* The model dimension is $1024$, with sequence lengths from $2^9=512$ to $2^{19}=524288$.\n* The convolution is an FFT-based convolution using PyTorch primitives.\n\n> Could the authors provide some intuitions why FlashAttention is the slowest when the sequence length is very large (Figure 8 left)?\n\nAttention (including FlashAttention) is a quadratic-time operator, and therefore is significantly slower than subquadratic operators (e.g. convolutions and linear recurrences) such as Mamba when the sequence length is long."
                    }
                },
                "number": 6,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission4202/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700730712912,
                "cdate": 1700730712912,
                "tmdate": 1700730712912,
                "mdate": 1700730712912,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    }
]
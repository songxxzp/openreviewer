[
    {
        "title": "Active Retrosynthetic Planning Aware of Route Quality"
    },
    {
        "review": {
            "id": "Kfy0Cp1cUz",
            "forum": "h7DGnWGeos",
            "replyto": "h7DGnWGeos",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission7875/Reviewer_23Kg"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission7875/Reviewer_23Kg"
            ],
            "content": {
                "summary": {
                    "value": "This work considers multi-step retrosynthetic search in a scenario where an expensive-but-accurate reaction quality metric is available. This motivates the authors to develop an algorithm that decides to query said metric adaptively, so that it can learn to trade-off the cost of querying it against other costs/rewards inherent to the routes themselves. The authors then run experiments to compare with existing retrosynthetic planning algorithms."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "3 good"
                },
                "contribution": {
                    "value": "3 good"
                },
                "strengths": {
                    "value": "(S1): The framework proposed by the authors is original, well-motivated, and generally reasonable. The paper also includes valuable discussion. \n\n- (a) In particular, the discussion on how routes produced by existing search algorithms may be not useful in the real world (due to e.g. the reaction being low yield or otherwise infeasible) is useful. This is something that should perhaps be given more attention in the ML-for-retrosynthesis  community. \n\n- (b) The high-level modelling and architectural choices are reasonable and appropriate for the task at hand.\n\n- (c) There are interesting connections of this work to retro-fallback [1] - a very recent parallel work - which is also concerned with the fact that the routes found by off-the-shelf algorithms may not be of high quality. However, I think the attack angles are somewhat complementary, as [1] tries to find _several_ routes that complement each other in their shortcomings, whereas this work focuses on _more accurately estimating the quality of a single route_ through a (possibly expensive) quality oracle. \n\n(S2): The paper is generally well-written and easy to understand (although with some room for improvement; see the \"Questions\" and \"Nitpicks\" sections)."
                },
                "weaknesses": {
                    "value": "(W1): My main concern is that it is not very clear to me what the quality metric would actually be in a real-life scenario and how it would be implemented. First, the framework proposed by the authors seems to only make sense if querying the quality metric is _expensive but not too expensive_: if the quality oracle is not much more expensive that the single-step model itself (e.g. if it's a yield prediction model), then there is no need for the adaptive querying; if the metric is very expensive (e.g. asking a human chemist or running the reaction in the lab) then it wouldn't make sense to allow the algorithm to query it autonomously, even if it only does so for e.g. 20% of the cases (as that would still be prohibitively expensive and the human/lab would become a bottleneck). What would a realistic quality metric be? The authors in the paper use a trained model, which perhaps falls into the category of \"not expensive enough to bother with adaptive querying\", unless the model is *much* larger than the single-step model itself. Or perhaps the quality metric could result from e.g. running expensive quantum chemistry simulation, but this is a bit forward-looking as I don't think any existing frameworks for such calculations are robust enough to plug them in directly. Overall, at the very least I would expect more discussion on how the quality metric should be realized in practice. \n\n(W2): The related works section is missing several references of established/SotA models and algorithms. On the single-step side, it is missing LocalRetro [2], RetroKNN [3] and RootAligned [4]. On the multi-step side, it is missing PDVN [5]. \n\n=== Summary ===\n\nI like some aspects of this work, but the general real-world use case could be more discussed. I am looking forward to the rebuttal and, if productive, I may consider revising my score accordingly.\n\n=== Other comments === \n\n(O1): The introduction section casually mentions that the average length of a retrosynthetic route is 3.36 without giving any sources. Where does this come from? I think this number would heavily depend on the precise assumptions, and for very challenging molecules the average route length would be even higher than this. It may be better to change this statement to be more vague (e.g. say that the routes are usually 3 or more steps) and give a citation, instead of using a very specific number which is only true if one fixes a lot of variables. \n\n \n\n=== Nitpicks === \n\nBelow I list nitpicks (e.g. typos, grammar errors), which did not have a significant impact on my review score, but it would be good to fix those to improve the paper further. \n\n- \"while this often leads to substantial query costs\" -> in this context I would replace \"while\" with e.g. \"but\" \n\n- in many places there is a missing space before parenthesis (see the \"Multi-step planning\" part of the \"Related work\" section for some examples) \n\n- \"with is initialized\" -> \"which\" \n\n- \"Moreover, We define\" -> lowercase \"we\" \n\n- \"There are three steps for each roll\" -> \"rollout\"? \n\n- First sentence in the \"Reaction cost annotation\" paragraph is a bit hard to parse \n\n- \"USPTI-MIT\" -> \"USPTO-MIT\"? \n\n- Equation 9 looks as if it's missing some text \n\n \n\n=== References === \n\n[1] Tripp et al, \"Retro-fallback: retrosynthetic planning in an uncertain world\" \n\n[2] Chen et al, \"Deep Retrosynthetic Reaction Prediction using Local Reactivity and Global Attention\" \n\n[3] Xie et al, \"Retrosynthesis Prediction with Local Template Retrieval\" \n\n[4] Zhong et al, \"Root-aligned SMILES: a tight representation for chemical reaction prediction\" \n\n[5] Liu et al, \"Retrosynthetic Planning with Dual Value Networks\"\n\n=== Update 21/11 ===\n\nAfter the rebuttal, I increase my score to 6."
                },
                "questions": {
                    "value": "(Q1): Could you expand on \"critic takes both the current molecule and its preceding reaction cost as input\"? Is the previous reaction cost literally concatenated into the molecule representation somewhere as a single floating point number? \n\n(Q2): Is Equation 6 fully correct? I am confused about the fact that it does not include the discount factor $\\gamma$, and also the way $N(s)$ is used seems slightly off; I may be wrong though. \n\n(Q3): Could you elaborate on how the quality metric is used by the baseline algorithms like Retro* to produce the results from Table 2? I understand that for the baselines it is assumed the quality metric is always queried, which leads to 100% query rate. Could you discuss how the resulting quality value is used by the algorithms themselves during optimization? \n\n(Q4): Is the depth of the exhaustive search used to normalize route quality the same as the maximum depth that the search algorithms are allowed to explore?"
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "6: marginally above the acceptance threshold"
                },
                "confidence": {
                    "value": "4: You are confident in your assessment, but not absolutely certain. It is unlikely, but not impossible, that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work."
                },
                "code_of_conduct": {
                    "value": "Yes"
                },
                "first_time_reviewer": {
                    "readers": [
                        "ICLR.cc/2024/Conference/Program_Chairs",
                        "ICLR.cc/2024/Conference/Submission7875/Senior_Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission7875/Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission7875/Reviewer_23Kg"
                    ]
                }
            },
            "number": 1,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission7875/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698779100538,
            "cdate": 1698779100538,
            "tmdate": 1700569624194,
            "mdate": 1700569624194,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "1SyW0tAYhA",
                "forum": "h7DGnWGeos",
                "replyto": "Kfy0Cp1cUz",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer 23Kg(1/2)"
                    },
                    "comment": {
                        "value": "We sincerely thank the reviewer for providing valuable feedback. We detail our response below point by point. Please feel free to let us know if you have any additional concerns or questions.\n\n**Real-life scenarios**\n\n> We wholeheartedly agree with the reviewer that the quality metric required by our framework in a real-life scenario should be **expensive but not prohibitively so**. This consideration constitutes the primary motivation behind our active planning framework, aiming to query a minimum number of reaction quality annotations while still planing high-quality routes.\n> \n> While our current implementation involves querying the surrogate model, our inspiration is drawn directly from real-life retrosynthesis planning scenarios, such as in online softwares like SYNTHIA, where **chemists are pivotal end users**. In this context, **integrating chemists as valuable resources into the AI planning process** will be invaluable for planning routes that are not only feasible but also of practical high-quality. We envision the successful deployment of our framework in this scenario for several reasons.\n> - Online annotation by chemists introduces minimal time delays and manageable labor costs, making it an **ideal candidate for a route quality metric** that is expensive but not prohibitively so. \n> - Our framework is intentionally designed to be **compatible with various types of annotations, including a coarse-grained quality rating from 0 to 10**. We believe such a rating is sufficient for the planner to make satisfactory decisions. Additionally, this rating can also be seamlessly integrated into our current framework by replacing the bucket index to which a quality value belongs (see details in Section 3.2 in the revision) with this discrete rating.\n>  - Chemists contribute **valuable insights beyond mere reaction yields**, such as knowledge about preferred reactions in real-world synthesis contexts, which can include factors like toxicity, material costs and work-up difficulty (post-process, like purification or separation).\n\n\n**Related works** \n> We thank the reviewer for pointing out these recent important related works [2-6], which we have cited and discussed in the revision version. \n> - **Related works on multi-step retrosynthesis planning**\n>   - [5] employs an RL-based method to improve single-step practicality, aiming to discover shorter routes with lower costs. However, **[5] does not consider real-world reaction qualities**, by treating not-dead reaction costs as 1 and evaluating routes based solely on their length.\n>   - As a complementary, our work contributes to finding high-quality routes by actively querying the real-world reaction qualities. We have proven the capability to reduce query costs while maintaining high route qualities. Importantly, **our active framework is compatible with retrosynthetic planning methods like [5]**.\n> - **Related works on single-step retrosynthesis prediction**\n>   - [2] addresses the identification and completion processes by employing local template prediction combined with a global attention mechanism. \n>   - [3] tackles the concern that fixed parameters might be sub-optimal by introducing a robust non-parametric local reaction template retrieval approach.\n>   - [4] resolves the issue of SMILES neglecting the characteristics of molecular graph topology and reaction atom transformations.\n>   **Our focus on retrosynthetic planning** can readily integrate with the success achieved by recent state-of-the-art single-step retrosynthesis prediction methods.\n\n\n\n\n**Nitpicks** \n\n> We appreciate your advice to help us improve this paper and revise the mentioned nitpicks in the revision.\n\n>[1] Binghong Chen et al. \"Retro\\*: Learning Retrosynthetic Planning with Neural Guided A\\* Search\". \n>\n>\n>[2] Chen et al, \"Deep Retrosynthetic Reaction Prediction using Local Reactivity and Global Attention\"\n>\n>[3] Xie et al, \"Retrosynthesis Prediction with Local Template Retrieval\"\n>\n>[4] Zhong et al, \"Root-aligned SMILES: a tight representation for chemical reaction prediction\"\n>\n>[5] Liu et al, \"Retrosynthetic Planning with Dual Value Networks\""
                    }
                },
                "number": 5,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700401529016,
                "cdate": 1700401529016,
                "tmdate": 1700401529016,
                "mdate": 1700401529016,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "0Eik9BQSh1",
                "forum": "h7DGnWGeos",
                "replyto": "Kfy0Cp1cUz",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer 23Kg(2/2)"
                    },
                    "comment": {
                        "value": "**Q1**: Could you expand on \"critic takes both the current molecule and its preceding reaction cost as input\"? Is the previous reaction cost literally concatenated into the molecule representation somewhere as a single floating point number?\n> The preceding reaction cost is **concatenated in the format of its representation as $\\mathcal{O}(a^r,a^q)$** in Eq.(2). Concretely,\n>   - When $a^q=1$, we derive $\\mathcal{O}(a^r,a^q)$ from (1) discretizing continuous reaction quality values into $N^M$ discrete buckets, (2) learning $N^M$ trainable embeddings in $d^M$ dimensions for all buckets within our critic, and (3) determining the bucket index that the queried quality value $u$ belongs to and thereby the associated bucket embedding. \n>   - when $a^q=0$, $\\mathcal{O}(a^r,a^q)=\\mathbb{M}$ as a $d^M$-dimensional trainable embedding. \n> - In our implementation, we consider $d^M=512$ and $N^M=18$ buckets which are defined in Fig 6 in the revision. These buckets are obtained via (1) collecting ~28M reactions during planning by GRASP and Retro$^*$, (2) computing their reaction qualities by our surrogate model, and (3) defining the bucket boundaries to ensure that each bin covers a similar number of reactions.\n\n**Q2**: Is Equation 6 fully correct? I am confused about the fact that it does not include the discount factor $\\gamma$, and also the way $N(s)$ is used seems slightly off; I may be wrong though.\n\n> We apologize for any confusion arising from the equations with respect to $Q^*$ and we further clarify Eq.(5) and Eq.(6) in the revision version. \n> - The visit count number $N(s)$ is used for the **reaction action selection**: $a^r_t=argmax_{a^{r}\\in ch(s_t|T)}Q^*(s_t,a^{r})$ where $Q(s_t, a^r_t)$ is a value initialized by our critic network $Q_\\theta(s_{t+1},\\mathcal{O}(a^r_t,\\pi_\\phi(a^r_t)))$ and updated afterwards. The $Q^*$ function, quantifying the molecular synthesizability, is computed using the following equation:\n> $$\n> Q^*(s_t,a^r_t)=Q(s_t, a^r_t)+\\beta\\frac{\\sqrt{N(s_{t-1},a^r_{t-1})}}{1+N(s_t,a^r_t)}\n> $$\n> - The visited count number $N(s)$ is **also employed in the update step**. The $Q(s_t, a^r_t)$ values are updated in association with the visit counts of the state-action pair using the following equation where $Q'$ is the $Q$ values of newly added state-action pairs. This update process also incorporates the discounting factor $\\gamma$ as mentioned in the main text.\n> $$\n> Q'(s_t,a^r_t) = Q(s_t,a^r_t) + \\frac{1}{N(s_t,a_t)}(\\gamma Q'-Q(s_t,a^r_t))\n> $$\n\n\n\n\n**Q3**: Could you elaborate on how the quality metric is used by the baseline algorithms like Retro* to produce the results from Table 2? I understand that for the baselines it is assumed the quality metric is always queried, which leads to 100% query rate. Could you discuss how the resulting quality value is used by the algorithms themselves during optimization?\n\n> Retro* [1] leverages the A* search algorithm with the value of a molecule defined as\n> $$\nV_t(m|T)=g_t(m|T)+h_t(m|T).\n$$\n> - For the **heuristic function $h_t(m|T)$**, we retrained the value network $V_m$ with the same hyperparameters from [1].\n> - For the **reaction costs $g_t(m|T)$**,  we compute the reaction costs for each step **using our surrogate model** instead of the single-step probabilities.\n> \n\n\n\n\n**Q4**: Is the depth of the exhaustive search used to normalize route quality the same as the maximum depth that the search algorithms are allowed to explore?\n\n> Yes. We set the depth of both the exhaustive search and the planning process to be 6.\n\n> [1] Binghong Chen et al. \"Retro\\*: Learning Retrosynthetic Planning with Neural Guided A\\* Search\"."
                    }
                },
                "number": 6,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700401665158,
                "cdate": 1700401665158,
                "tmdate": 1700409274326,
                "mdate": 1700409274326,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "qyMFkXYwVe",
                "forum": "h7DGnWGeos",
                "replyto": "Kfy0Cp1cUz",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "content": {
                    "title": {
                        "value": "We would love to hear back from Reviewer 23Kg"
                    },
                    "comment": {
                        "value": "Hi Reviewer 23Kg,\n\nWe would like to follow up to see if our response addresses your concerns or if you have any further questions. We would really appreciate the opportunity to discuss this further if our response has not already addressed your concerns.\n\nThank you again!"
                    }
                },
                "number": 8,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700558144728,
                "cdate": 1700558144728,
                "tmdate": 1700558144728,
                "mdate": 1700558144728,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "4oNogG9Grt",
                "forum": "h7DGnWGeos",
                "replyto": "qyMFkXYwVe",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Reviewer_23Kg"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Reviewer_23Kg"
                ],
                "content": {
                    "title": {
                        "value": "Response"
                    },
                    "comment": {
                        "value": "> Online annotation by chemists introduces minimal time delays and manageable labor costs, making it an ideal candidate for a route quality metric that is expensive but not prohibitively so.\n\nI guess this makes sense; my thinking was that if the chemist is queried for e.g. 20% of the reactions then it would still be a bottleneck, but perhaps if it's a few % then that would be fine. A related question would be how to train the model to make use of the oracle without actually calling the oracle, as one may want to avoid introducing chemists during the training process to save their time (also, an untrained model may intially try to query the oracle much more often than is optimal). Perhaps it would be fine to train with a surrogate model of chemist preference and then use an actual chemist during inference.\n\nEither way, I think the direction outlined by the authors is interesting. It would be good to make sure the paper makes it clear that, in a real application, the quality metric may be \"implemented\" by querying a chemist.\n\n---\n\nOther clarifications and changes (to e.g. the equations) look good to me. It's also good that the authors included more related work polled from the reviewers. I raise my score from 5 to 6."
                    }
                },
                "number": 10,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700569543920,
                "cdate": 1700569543920,
                "tmdate": 1700569543920,
                "mdate": 1700569543920,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "By8myqDbiE",
            "forum": "h7DGnWGeos",
            "replyto": "h7DGnWGeos",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission7875/Reviewer_zSxo"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission7875/Reviewer_zSxo"
            ],
            "content": {
                "summary": {
                    "value": "The paper addresses the challenge of retrosynthetic planning when the reaction cost is unknown during the planning process. To balance the trade-off between query costs and route quality evaluation, the authors introduce the Active Retrosynthetic Planning (ARP) framework. This framework employs an actor-critic model to decide whether to query reaction costs and to estimate molecule values. The ARP framework demonstrates a 6.2% improvement in route quality on a benchmark dataset and a 4.9% improvement on an annotated dataset, while reducing the number of query costs."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "3 good"
                },
                "contribution": {
                    "value": "3 good"
                },
                "strengths": {
                    "value": "- The paper identifies a key issue in retrosynthetic planning: the assumption of knowing the reaction cost for every reaction during the planning phase is impractical. In response, the authors introduce a novel solution by leveraging an actor-critic framework from reinforcement learning to address this problem.\n- The proposed method demonstrates strong empirical performance on top of state-of-the-art methods, as shown in comprehensive evaluations.\n- The proposed method is generic, able to work alongside various existing retrosynthetic planners, enabling their capabilities to balance between query costs and route quality evaluation.\n- The paper introduces the normalized route quality to normalize the scores for different synthesis routes, thus improving the accuracy of planning outcome evaluation."
                },
                "weaknesses": {
                    "value": "- In the ablation study, actor+critic does not show consistent and significant improvement on success rate compared with random+critic baseline. The paper should include additional discussion to clarify this issue."
                },
                "questions": {
                    "value": "- In the ablation study, why doesn't the actor+critic consistently and significantly improve the success rate compared to the random+critic baseline, as observed with normalized route quality?\n- Why doesn't the success rate change monotonically with the query rate, unlike the normalized route quality?"
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "8: accept, good paper"
                },
                "confidence": {
                    "value": "4: You are confident in your assessment, but not absolutely certain. It is unlikely, but not impossible, that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work."
                },
                "code_of_conduct": {
                    "value": "Yes"
                }
            },
            "number": 2,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission7875/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698799883373,
            "cdate": 1698799883373,
            "tmdate": 1699636965821,
            "mdate": 1699636965821,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "wY0n35LrHS",
                "forum": "h7DGnWGeos",
                "replyto": "By8myqDbiE",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer zSxo"
                    },
                    "comment": {
                        "value": "Thank you sincerely for your thoughtful and positive feedback on our work. We are particularly grateful for your recognition of the various aspects of our research. Below, we have provided a detailed explanation for your remaining concern as follows. Please do not hesitate to let us know if you have any further questions.\n\n**Q1**: In the ablation study, why doesn't the actor+critic consistently and significantly improve the success rate compared to the random+critic baseline, as observed with normalized route quality?\n\n**Q2**: Why doesn't the success rate change monotonically with the query rate, unlike the normalized route quality?\n\n> We address **Q1** and **Q2** together because of their high correlation. We have added a discussion into Section 4.2 and a case illustration in Appendix D in the revision. \n> - (1) **The success rate and route quality are two distinct and potentially conflicting objectives**, as illustrated in the case study of Fig 8 in Appendix D. In the figure, the root molecule $M_0$ has three candidate reactions, and $R_0$ is identified as a high quality reaction. However, the child molecule $M_1$ of $R_0$ is an unexpandable dead node with no further reaction candidates. \n>     - If the planner selects based only on observable next-state molecular structures of $M_1$, $M_2$ and $M_3$, **being agnostic of the reaction quality values of $R_0$, $R_1$ and $R_2$,** it might select $R_2$ for its most synthesizable next-state molecule $M_3$. \n>     - Alternatively, **given observable reaction quality values $R_0$, $R_1$ and $R_2$**, the planner could be misled into selecting $R_0$ due to its highest route quality. \n> - (2) The \"actor\" in Table 3/4 is a policy network $\\pi_\\phi$ that decides whether to query the quality of reactions. By taking the reaction quality as rewards (see Eq.(1) for details), **the actor is trained to prioritize querying those reactions that contribute to high-quality routes**. \n> - Considering (1) the disparity between high-quality and high success rates and (2) the actor optimized towards high-quality only, it is reasonable that\n>    - actor+critic does not show consistent and significant improvement on success rates compared to random+critic;\n>    - the success rate does not change monotonically with the query rate."
                    }
                },
                "number": 1,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700400594843,
                "cdate": 1700400594843,
                "tmdate": 1700400594843,
                "mdate": 1700400594843,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "E8vKksoA3D",
                "forum": "h7DGnWGeos",
                "replyto": "wY0n35LrHS",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Reviewer_zSxo"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Reviewer_zSxo"
                ],
                "content": {
                    "comment": {
                        "value": "Thank you for addressing my concerns. I have no follow up questions."
                    }
                },
                "number": 12,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700583969495,
                "cdate": 1700583969495,
                "tmdate": 1700583969495,
                "mdate": 1700583969495,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "x3FDjzL9vq",
            "forum": "h7DGnWGeos",
            "replyto": "h7DGnWGeos",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission7875/Reviewer_BDYr"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission7875/Reviewer_BDYr"
            ],
            "content": {
                "summary": {
                    "value": "This paper aims to consider the route quality (i.e., yield of a reaction) in the retrosynthetic planning problem. Since querying such information requires labor-intensive lab/expert verification, this paper proposes an active planning framework to strike a balance between query cost and route quality. This framework consists of an actor that decides whether to query the cost of a reaction or not and a critic that evaluates whether to expand a molecule or not."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "2 fair"
                },
                "contribution": {
                    "value": "3 good"
                },
                "strengths": {
                    "value": "1. The route quality in terms of yield is of pivotal significance for practical CASP, and this paper is well motivated from this perspective;\n2. The active planning framework is designed to consider route quality, with balancing the query cost; the actor-critic technique adopted in general is reasonable and justified;\n3. The evaluation using defined metrics support the major claims of balancing query quality and rate."
                },
                "weaknesses": {
                    "value": "1. The paper representation can be improved with better clarification. See details in Questions.\n2. Some claims that motivate the method should be verified. See details in Questions.\n3. Important related work [1] that targets on multi-step planning should be discussed.\n\n[1] Liu, Songtao, et al. \"FusionRetro: molecule representation fusion via in-context learning for retrosynthetic planning.\" International Conference on Machine Learning. PMLR, 2023."
                },
                "questions": {
                    "value": "#### Unverified Claims\n1. In reaction cost annotation, the authors adopt a surrogate model to provide reaction cost annotation, and hope \u201cthe model prioritizes the identification of high-yield reactions over high-frequency reactions\u201d. Can the authors empirically verify this claim? \n2. Are there real cases when high-yield reactions and high-frequency reactions are not overlapping? Intuitively, high-frequency reactions are usually high-yield ones, otherwise they cannot be frequently collected in a dataset, right?\n\n#### Method\n3. How is the state encoder $\\mathcal{E}$ trained? It should also wrap $s_t$ in Eq. (4), right?\n4. In Selection, is there any exploration or possibility to generate multiple routes? \n5. How is the masked value M set?\n6. During inference, does the method require the external surrogate model to obtain the reaction cost? How accurate/reliable is this surrogate model?\n\n#### Writing\n7. The term \u201creaction cost\u201d is misleading and inconsistent: \u201ccost\u201d usually refers to some undesired property that should be as low as possible, however, this paper defines cost as yield (i.e., higher \u201ccost\u201d indicates better quality). This is misleading and counterintuitive. Meanwhile, \u201cobserving in Fig, 2 that a molecule with a low preceding reaction cost should be prioritized to expand first\u201d, is clearly inconsistent with Fig. 2 (i.e., low-cost=low-quality route should not be prioritized). \n8. The description of Expansion in the inference stage is not clear. Q* sometimes refers to a value, or a function (i.e., in Eq. (5)), which is confusing. What is Q*(a) and Q*(s) exactly?"
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "6: marginally above the acceptance threshold"
                },
                "confidence": {
                    "value": "3: You are fairly confident in your assessment. It is possible that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work. Math/other details were not carefully checked."
                },
                "code_of_conduct": {
                    "value": "Yes"
                },
                "first_time_reviewer": {
                    "readers": [
                        "ICLR.cc/2024/Conference/Program_Chairs",
                        "ICLR.cc/2024/Conference/Submission7875/Senior_Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission7875/Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission7875/Reviewer_BDYr"
                    ]
                }
            },
            "number": 3,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission7875/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1699067067563,
            "cdate": 1699067067563,
            "tmdate": 1700584526624,
            "mdate": 1700584526624,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "xlwboxyzp3",
                "forum": "h7DGnWGeos",
                "replyto": "x3FDjzL9vq",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer BDYr(1/3)"
                    },
                    "comment": {
                        "value": "We sincerely appreciate your constructive comments on this paper. We detail our response below point by point. Please kindly let us know if our response addresses the issues you raised in this paper.\n\n**Related works** \n>We thank the reviewer for pointing out this recent  and important related work [1], which we have duly cited and discussed in the revision. \n> - [1] introduces a novel multi-step planning approach via in-context learning, departing from conventional search algorithms. However, its primary objective is still evaluating success rates of planned routes.\n> - Our major contributions lie in an active framework capable of synsthesizing routes with not only high success rates but also high quality. Thus, we have proved the **compatibility and orthogonality of ours with other multi-step planning strategies** like Retro*; it is also readily extendable to state-of-the-art planning methods like [1].\n\n**Unverified claims**\n\n**Q1**: In reaction cost annotation, the authors adopt a surrogate model to provide reaction cost annotation, and hope \u201cthe model prioritizes the identification of high-yield reactions over high-frequency reactions\u201d. Can the authors empirically verify this claim?\n\n> - Our active planning framework utilizes the **reaction quality** annotated by our surrogate model as **rewards**. Consequently, **as long as reaction qualities predicted by the surrogate model show high correlations with yields**, the model learns a policy that prioritizes high-yield reactions over high-frequency ones. \n> - We proceed to validate that reaction qualities by our surrogate model indeed demonstrates a high correlation with yields.\n>    - The training of our surrogate model involves two steps: (1) pre-training on the USPTO-MIT dataset, and (2) finetuning on an in-house expert dataset of routes featuring high-yield reactions. It is important to note that we **introduce step (2) precisely to ensure that high predictive probabilities from our surrogate model align with high yields**. \n>    - To evaluate our surrogate model, we resort to a route-with-yield test set. Following the method described in [2], we extract synthesis routes with yields from the USPTO-milligram-scale reaction yield dataset [3]. For evaluation purposes, we randomly select 200 routes, encompassing approximately 1000 reactions. \n>    - We thereby calculate the Pearson correlation coefficient(PCC) between the reaction quality predicted by our surrogate model and the literature yield. In Fig 7 of the revised manuscript, (a) illustrates the 0.059 PCC of the pre-trained model while (b) shows the **0.611 PCC of the finetuned model**, providing strong evidence that **the surrogate model accurately predicts yields**.\n\n**Q2**: Are there real cases when high-yield reactions and high-frequency reactions are not overlapping? Intuitively, high-frequency reactions are usually high-yield ones, otherwise they cannot be frequently collected in a dataset, right?\n\n> Frequently collected reactions in a single-step dataset are **not necessarily** high-yield, which we substantiate based on an analysis from [3] that explores yields reported in the open-source USPTO dataset. \n> \n> - The **USPTO dataset with reaction yields** in sub-gram scale [3] contains a large number of reactions and a broad range of superclasses, and a reaction distribution closely resembling that of the USPTO single-step dataset, such as USPTO-MIT. \n> -  The actual reaction yield distribution of the above dataset, originally presented in [3], is depicted in Fig 5c. Notably, a significant proportion of reactions within the dataset exhibits relatively low yields, affirming that the USPTO single-step dataset is **not inherently biased to high-yield reactions**. \n> - **High-frequency $\\neq$ high-yield** Fig 5a (originally presented in [3]) shows various superclasses of reactions, where each color corresponds to a superclass and the coverage area of each color roughly represents the frequency of that superclass of reactions in the dataset. Combining Fig 5a and 5b, we conclude that high-frequency superclasses do not show a significant correlation with high yields. For example, the superclasses annotated in purple and cyan demonstrate low yields, with only the green reaction superclass corresponding to high yields in Fig 5b.\n\n> [1] Liu, Songtao, *et al*. \"FusionRetro: molecule representation fusion via in-context learning for retrosynthetic planning\".\n>\n> [2] Binghong Chen *et al*. \"Retro\\*: Learning Retrosynthetic Planning with Neural Guided A\\* Search\". \n>\n> [3] Philippe Schwaller *et al*. \"Prediction of chemical reaction yields using deep learning\""
                    }
                },
                "number": 2,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700400933749,
                "cdate": 1700400933749,
                "tmdate": 1700401169816,
                "mdate": 1700401169816,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "NNHAN71H6y",
                "forum": "h7DGnWGeos",
                "replyto": "x3FDjzL9vq",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer BDYr(2/3)"
                    },
                    "comment": {
                        "value": "**Method**\n\n**Q3**: How is the state encoder $\\mathcal{E}$ trained? It should also wrap $\\mathcal{E}$ in Eq. (4), right?\n\n> We first apologize for any ambiguity. We have updated Eq.(4) along with its descriptions in response. \n>  - If $\\mathcal{E}$ is an **offline estimator** such as the value estimator in Retro*, it is trained before implementation in our framework. The parameters of $\\mathcal{E}$ are frozen and not evolved in training of the critic.\n>  - If $\\mathcal{E}$ is an **online estimator**, it can be regarded as part of the critic parameters and is wrapped with the other critic parameters  for training. \n\n**Q4**: In Selection, is there any exploration or possibility to generate multiple routes?\n\n> We thank the reviewer's great comment, and have accordingly updated Section 3.3 to detail the definition of **$Q^*$ which involves exploration**.\n> \n> Concretely, the function $Q^*$ is defined as \n> $$\n> Q^*(s_t,a^r_t)=Q(s_t, a^r_t)+\\beta\\frac{\\sqrt{N(s_{t-1},a^r_{t-1})}}{1+N(s_t,a^r_t)}\n> $$\n> which follows the UCT(Upper Confidence Bound applied to Trees) function to balance between exploitation of the route with the maximum $Q$ and exploration of those less frequently visited routes. \n> \n\n**Q5**: How is the masked value M set?\n\n> - We set the mask as a $d^M$-dimensional trainable embedding. \n> - Meantime, it is crucial to emphasize the **consistency in the representation of $\\mathcal{O}(a^r,a^q)$**:\n>   - When $a^q=1$, we derive $\\mathcal{O}(a^r,a^q)$ from (1) discretizing continuous reaction quality values into $N^M$ discrete buckets, (2) learning $N^M$ trainable embeddings in $d^M$ dimensions for all buckets within our critic, and (3) determining the bucket index that the queried quality value $u$ belongs to and thereby the associated bucket embedding. \n>   - when $a^q=0$, as mentioned above, $\\mathcal{O}(a^r,a^q)=\\mathbb{M}$ as a $d^M$ dimensional embedding. \n> - In our implementation, we consider $d^M=512$ and $N^M=18$ buckets which are defined in Fig 6 in the revision. These buckets are obtained via (1) collecting ~28M reactions during planning by GRASP and Retro$^*$, (2) computing their reaction qualities by our surrogate model, and (3) defining the bucket boundaries to ensure that each bin covers a similar number of reactions.\n\n**Q6**: During inference, does the method require the external surrogate model to obtain the reaction cost? How accurate/reliable is this surrogate model?\n\n> - Our major contributions revolve around exactly an **active** planning framework that trains a querying actor/critic during training and later applies it **during inference** to plan a high-quality route with **minimal reaction quality annotation from an external surrogate model or a chemist expert**. \n> - Still, ours is compatible with existing multi-step planning methods such as Retro* as backbone planners. In scenarios where an external surrogate model or a chemist is unavailable, ours reduces to the backbone planner.  \n> - In **the response to Q1**, we have empirically validated the effectiveness of our surrogate model. Besides, our **case study in Appendix E** showcases that ours achieves **much higher route quality ratings by chemists**. This outcome provides strong evidence that the surrogate model faithfully reflects yields."
                    }
                },
                "number": 3,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700401151104,
                "cdate": 1700401151104,
                "tmdate": 1700401151104,
                "mdate": 1700401151104,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "KIR43D9HWN",
                "forum": "h7DGnWGeos",
                "replyto": "x3FDjzL9vq",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer BDYr(3/3)"
                    },
                    "comment": {
                        "value": "**Writing**\n\n**Q7**: The term \u201creaction cost\u201d is misleading and inconsistent: \u201ccost\u201d usually refers to some undesired property that should be as low as possible, however, this paper defines cost as yield (i.e., higher \u201ccost\u201d indicates better quality). This is misleading and counterintuitive. Meanwhile, \u201cobserving in Fig, 2 that a molecule with a low preceding reaction cost should be prioritized to expand first\u201d, is clearly inconsistent with Fig. 2 (i.e., low-cost=low-quality route should not be prioritized).\n\n> We apologize for any confusion arising from the term \"reaction cost\". For a more straightforward and intuitive understanding, we have revised all instances of the term \"reaction cost\" into \"reaction quality\" as well as Fig 2 in the updated version.\n\n**Q8**: The description of Expansion in the inference stage is not clear. $Q^*$ sometimes refers to a value, or a function (i.e., in Eq. (5)), which is confusing. What is $Q^*(a)$ and $Q^*(s)$ exactly?\n\n> For a better understanding, we have replaced $Q^*(s_t)$ and $Q^*(a^r_t)$ with a unified form $Q^*(s_t, a^r_t)$ in Eq 5 and Eq 6. $Q^*$ is a function that quantifies the synthesizability of a state-action pair as outlined below. Inside the equation, $N(s, a^r)$ denotes the visit count number. $Q(s_t, a^r_t)$ is a value initialized by $Q_\\theta(s_{t+1},\\mathcal{O}(a^r_t,\\pi_\\phi(a^r_t)))$ and updated afterwards.\n> $$\n> Q^*(s_t,a^r_t)=Q(s_t, a^r_t)+\\beta\\frac{\\sqrt{N(s_{t-1},a^r_{t-1})}}{1+N(s_t,a^r_t)}\n> $$\n> During a selection step, We recursively perform a reaction action selection $a^r_t=argmax_{a^{r}\\in ch(s_t|T)}Q^*(s_t,a^{r})$ and obtain the next state $s_{t+1}$ by tranition function $\\mathcal{P}$ until reaching a leaf molecule node. In a update step, we perform a $Q(s_t,a^r_t)$ value backward traversal as follow where $Q'$ is the $Q$ values of newly added state-action pairs.\n> $$\n> Q'(s_t,a^r_t) = Q(s_t,a^r_t) + \\frac{1}{N(s_t,a_t)}(\\gamma Q'-Q(s_t,a^r_t))\n> $$"
                    }
                },
                "number": 4,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700401234853,
                "cdate": 1700401234853,
                "tmdate": 1700401234853,
                "mdate": 1700401234853,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "kqB0W8rPgp",
                "forum": "h7DGnWGeos",
                "replyto": "x3FDjzL9vq",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "content": {
                    "title": {
                        "value": "We would love to hear back from Reviewer BDYr"
                    },
                    "comment": {
                        "value": "Hi Reviewer BDYr,\n\nWe would like to follow up to see if our response addresses your concerns or if you have any further questions. We would really appreciate the opportunity to discuss this further if our response has not already addressed your concerns.\n\nThank you again!"
                    }
                },
                "number": 9,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700558182864,
                "cdate": 1700558182864,
                "tmdate": 1700558182864,
                "mdate": 1700558182864,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "iqEOG0E3Nq",
                "forum": "h7DGnWGeos",
                "replyto": "x3FDjzL9vq",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Reviewer_BDYr"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Reviewer_BDYr"
                ],
                "content": {
                    "title": {
                        "value": "Thanks for the Explanations"
                    },
                    "comment": {
                        "value": "I appreciate the authors providing detailed evidence and explanations to my questions. I have also read the updated version with improved clarity. Since my concerns were all addressed, I raised my score from 5 to 6."
                    }
                },
                "number": 13,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700584503234,
                "cdate": 1700584503234,
                "tmdate": 1700584503234,
                "mdate": 1700584503234,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "LGDsq64SJT",
            "forum": "h7DGnWGeos",
            "replyto": "h7DGnWGeos",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission7875/Reviewer_iEQU"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission7875/Reviewer_iEQU"
            ],
            "content": {
                "summary": {
                    "value": "an RL based search algorithm that incorporates some definition of route quality for retrosynthesis is proposed.\n\n\nedit after discussion\n- I am still not 100% convinced about the novelty of this work, but nevertheless will raise the score."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "2 fair"
                },
                "contribution": {
                    "value": "2 fair"
                },
                "strengths": {
                    "value": "- interesting new ideas of using RL for scoring applied to retrosynthesis"
                },
                "weaknesses": {
                    "value": "- somewhat disconnected from previous evaluation\n- the model to assign quality is not described in enough detail\n- it is not convincingly defined what reaction quality is\n- prior work is not correctly attributed\n\n\"Practical efficacy: we, for the first time, draw\nan insight into the disappointing practicality of existing retrosynthetic planners that regard single-step probabilities as reaction qualities.\"\n\nDifferent and flexible ways to incorporate step and route cost beyond single step probabilities) was already included in many prior works, for example Segler (2018), Coley (2019) and Schwaller (2020). These works also used reaction feasibility models, which are a proxy for quality. Please reference this accordingly.\nalso, the method seems to be very similar to Liu et al 2023, which is also a very flexible framework able to incorporate arbitary cost. this needs to be discussed more carefully.\nI think the paper can receive higher score if prior work is referenced properly, but in the current form this is insufficient."
                },
                "questions": {
                    "value": "- I would suggest to order the related work section, in particular the Multi-step planning section, by the order in which the works appeared, because subsequent works influenced each other."
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "details_of_ethics_concerns": {
                    "value": "-"
                },
                "rating": {
                    "value": "6: marginally above the acceptance threshold"
                },
                "confidence": {
                    "value": "5: You are absolutely certain about your assessment. You are very familiar with the related work and checked the math/other details carefully."
                },
                "code_of_conduct": {
                    "value": "Yes"
                },
                "first_time_reviewer": {
                    "readers": [
                        "ICLR.cc/2024/Conference/Program_Chairs",
                        "ICLR.cc/2024/Conference/Submission7875/Senior_Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission7875/Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission7875/Reviewer_iEQU"
                    ]
                }
            },
            "number": 4,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission7875/-/Official_Review"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1700694125287,
            "cdate": 1700694125287,
            "tmdate": 1700740837071,
            "mdate": 1700740837071,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "ICWgRWCxJB",
                "forum": "h7DGnWGeos",
                "replyto": "LGDsq64SJT",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer iEQU(1/3)"
                    },
                    "comment": {
                        "value": "We thank the reviewer for providing feedback. Below, we detail our response point by point. \n\n**Clarification on Our Major Contributions**\n> In response to the reviewer's summary characterizing our work as ``an RL based search algorithm that incorporates some definition of route quality for retrosynthesis is proposed'', we express concerns about potential misinterpretations of the major contributions of our work. To address this, we elaborate as follows.\n> - Our contribution lies in not first incorporation of route quality related metrics into retrosynthesis. \n> - Our contribution lies in being the first in acknowledging the cost of annotating reaction quality, and thereby enabling the practical incorporation of costly-yet-accurate route quality evaluation into retrosynthesis through an **active and interactive** manner. Our motivations and contributions can be encapsulated in the following points:\n>   - (1) There has been **a lack of efficient-to-evaluate and meantime qualified route quality metrics**; for example,\n>     - (a) Predicted yield by a prediction model [efficient but inaccurate]: constructing accurate and robust yield prediction models has historically been challenging, explaining existing models being confined to specific reaction types.\n>     - (b) Route length [efficient but unfaithful]: The illustration in Fig. 1 of the main text demonstrates that a short route might yield less than a longer one.\n>     - (c ) Single-step probabilities [efficient but inaccurate]: As noted in our Introduction, single-step probabilities primarily reflect feasibility rather than reaction quality.\n>     - (d) SCScore [efficient but inaccurate]: While SCScore quantifies synthesizability (feasibility), it neglects actual reaction performance quality.\n>     - (e) Chemist rating [more accurate but less inefficient]: Chemists offer an overall evaluation of reaction yield, but this process is less efficient than a prediction model.\n>     - (f) Lab experiment verification [accurate but inefficient]: While reflective of groundtruth reaction quality, including yields, this approach is exceedingly time-consuming.\n>   - (2) The preceding works, including [1]-[4] the reviewer mentioned, operate **under the assumption that annotating route quality is labor-free and trivial**. Consequently, they accommodate metrics (a)-(d), as incorporation of highly accurate evaluation (e)-(f) for every reaction along the planned route is deemed prohibitively costly.\n>   - (3) Thus, we are motivated to propose this **\"active\"** retrosynthetic planning framework, strategically **minimizing the reactions where we query metrics such as (e)-(f) while sufficiently improve the route quality**.\n>      - Example: In the case of a molecule requiring 25 synthesis steps, our framework endeavors to pinpoint only 2 key reactions (10% querying rate) for the evaluation of either (e) or (f).\n>      - This framework **maintains compatibility with existing retrosynthesis planning methods**, a validation substantiated in our experiments on Retro* and GRASP. Take Liu et al. 2023 [3] as an example. If training the PDVN with ARP online, the synthesizability value Network $R$ and the cost value network $Q$ in PDVN are incorporated into the estimator $\\mathcal{E(s_t)}$ in the ARP framework by $\\mathcal{E(s_t)}=R(s_{t-1},a^r_{t-1})*Q(s_{t-1},a^r_{t-1})+(1-R(s_{t-1},a^r_{t-1}))*c_{dead}$.\n>   - (4) In our current implementation, we adopt the surrogate model as a surrogate for (e)-(f), which however does not compromise the effectiveness of our active planner.\n\n> [1] Segler, M., Preuss, M. & Waller, M. Planning chemical syntheses with deep neural networks and symbolic AI. Nature 555, 604\u2013610 (2018).\n>\n> [2] John S. Schreck, Connor W. Coley, and Kyle J. M. Bishop Schreck. Learning Retrosynthetic Planning through Simulated Experience. ACS Central Science 2019\n>\n> [3] Guoqing Liu, Di Xue, Shufang Xie, Yingce Xia, Austin Tripp, Krzysztof Maziarz, Marwin Segler, Tao Qin, Zongzhang Zhang, and Tie-Yan Liu. 2023. Retrosynthetic planning with dual value networks. In Proceedings of the 40th International Conference on Machine Learning (ICML'23)\n>\n> [4] Schwaller P, Petraglia R, Zullo V, Nair VH, Haeuselmann RA, Pisoni R, et al. Predicting Retrosynthetic Pathways Using a Combined Linguistic Model and Hyper-Graph Exploration Strategy. ChemRxiv. Cambridge: Cambridge Open Engage; 2019."
                    }
                },
                "number": 17,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700739810883,
                "cdate": 1700739810883,
                "tmdate": 1700739936717,
                "mdate": 1700739936717,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "G7xT04NGD3",
                "forum": "h7DGnWGeos",
                "replyto": "LGDsq64SJT",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer iEQU(2/3)"
                    },
                    "comment": {
                        "value": "**Weakness**\n**W1**: Somewhat disconnected from previous evaluation\n> - To begin, we seek to draw a comparison between the metrics employed in our framework and those utilized in prior studies.\n>   - Our metrics: (c1) success rate, (o2) query rate, and (o3) normalized route quality. \n>   - Metrics in prior studies: (c1) success rate, (p2) average route length, and (p3) number of single-step model calls. \n> - We have already substantiated the superior performance of our framework in terms of (c1) success rate compared to previous planning methods.\n> - Concerning (p2) average route length, its application in previous works aimed to quantify a specific aspect of route quality. However, it is worth noting that this metric is **independent of real-world route quality**, as illustrated in Figure 1 of the main text. This motivates our adoption of (o3) normalized route quality for a more faithful evaluation.\n> - we extend our assessment to (p3) the number of single-step model calls. The performances of various baselines and our framework are outlined below. The GRASP approach achieves the fewest iterations among all baselines. Our approach, GRASP with ARP, surpasses GRASP by 1.2 in the benchmark dataset and by 3.9 in the expert dataset. In conclusion, our framework **enhances the planning efficiency** of the implemented planners.\"\n> \n> \n> | Model | Retro*-0 | Retro* | Retro*-0+ | Retro*+ | EG-MCTS-0 | EG-MCTS | GRASP | Retro* with ARP | GRASP with ARP |\n> | ---- | ---- | ---- | ---- | ---- | ----- | ---- | ---- | ----- | ----- |\n> | Benchmark test set | 69.2 | 53.5 | 52.6 | 48.7 | 45.9 | 43.1 | 41.3 | 46.0 | 40.1 |\n> | Expert test set | 36.7 | 33.2 | 28.9 | 25.7 | 33.4 | 28.9 | 22.6 | 25.6 | 18.7 |\n\n**W2**: The model to assign quality is not described in enough detail\n\n> - We had elucidated the training methodology for acquiring the surrogate model that assigns quality in the **paragraph of Reaction quality annotation in Section 4.1**. \n>   - \"*Initially, the method in Guo et al. (2020) is employed to pre-train a model utilizing the USPTO-MIT dataset, followed by the fine-tuning of the model in reactions derived from the high-quality, expert-annotated dataset*\"\n>   - We introduced this fine-tuning step on the expert dataset consisting of high yield reactions precisely to ensure that high predictive probabilities from our surrogate model **align with high yields**.\n> - We had included additional information on the implementation details in Appendix C and presented a thorough evaluation of the surrogate model itself in Appendix D.\n\n**W3**: It is not convincingly defined what reaction quality is\n\n> - We had defined the labor-intensive reaction quality in the Introduction section.\n>   - **Line 4 Section 1**: \"*The ideal reaction qualities that meet real-world chemical practicability, e.g., **yield of a reaction**, can be either annotated experimentally in a laboratory or by experienced chemists.*\"\n> - We had also detailed how to implement the reaction qualities so far for our framework in the **paragraph of Reaction quality annotation in Section 4.1**:\n>    - \"*Unfortunately, there is no established large-scale available reaction data set with respective reaction qualities or promising reaction performance, e.g. yield, prediction model(Jiang et al. (2022)), and both lab verification and expert annotations are expensive and time-consuming. We adopt a surrogate model to provide reaction quality annotations. ... During deployment, it is practical to replace the surrogate model with a chemist to provide online annotations, e.g. a coarse-grained quality rating from 0 to 10.*\""
                    }
                },
                "number": 18,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700739926073,
                "cdate": 1700739926073,
                "tmdate": 1700739926073,
                "mdate": 1700739926073,
                "license": "CC BY 4.0",
                "version": 2
            },
            {
                "id": "ielbG9lfhv",
                "forum": "h7DGnWGeos",
                "replyto": "LGDsq64SJT",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission7875/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Response to Reviewer iEQU(3/3)"
                    },
                    "comment": {
                        "value": "**W4**: Prior work is not correctly attributed, regarding Segler (2018) [1], Coley (2019) [2], Schwaller (2020) [4] and Liu et al 2023 [3].\n\n> As clarified in the aforementioned ``**Clarification on Our Major Contributions**'', our primary contributions stand distinct from the prior works [1-4]. Furthermore, our proposed framework further is compatible with and enhances the real-world practicality of there existing planners.\n>   - The planning methods in [1]-[4] only accommodate reaction cost metrics that are **efficient to have yet inaccurate to reflect real-world reaction quality such as yields**.\n>     - [1] utilzes a fixed heuristic based on starting material prices and reaction labor costs, unrelated to yields. \n>     - [2][3] consider the cost for each reaction as a uniform 1 and optimize towards shortest routes. However, a short route might have a lower yield than a long route. \n>     - [4] relies on a forward prediction likelihood biased to the high-frequency reactions and the SCScore. SCScore, which gauges molecule synthesizability (a.k.a. feasibility) but overlooks the real-world reaction performance quality.\n>  - The methodologies above **require the annotation of costs for every reaction along a route**. In the pursuit of incorporating reliable reaction qualities derived from chemists or lab experimentation, which entail significant costs, these methods tend to be economically impractical for real-world deployment.\n> - Therefore, our essential contribution lies in introducing  a framework designed to  **(1) actively decide when to query human evaluation (surrogate model in our current implementation)** and **(2) select a minimum number of reactions that are most informative to observe their quality annotations**. Our framework not only reduces query costs but also renders eminently practical in real-world scenarios.\n> - By specifically addressing the challenge of annotation costs, a facet often overlooked by previous works, our framework **not only accommodates but synergistically integrates with existing models**. This compatibility facilitates the seamless implementation of their models within our framework, thereby extending their active query capabilities.\n\n**Questions**\n\n**Q1**: I would suggest to order the related work section, in particular the Multi-step planning section, by the order in which the works appeared, because subsequent works influenced each other.\n\n> We arrange the order of the related work section by the search algorithm previous studies used. We highlight the search algorithm categories, e.g. $A^*$, $MCTS$\uff0c$RL$, in the revision version updated.\n\n\n>[1] Segler, M., Preuss, M. & Waller, M. Planning chemical syntheses with deep neural networks and symbolic AI. Nature 555, 604\u2013610 (2018).\n>\n>[2] John S. Schreck, Connor W. Coley, and Kyle J. M. Bishop Schreck. Learning Retrosynthetic Planning through Simulated Experience. ACS Central Science 2019\n>\n>[3] Guoqing Liu, Di Xue, Shufang Xie, Yingce Xia, Austin Tripp, Krzysztof Maziarz, Marwin Segler, Tao Qin, Zongzhang Zhang, and Tie-Yan Liu. 2023. Retrosynthetic planning with dual value networks. In Proceedings of the 40th International Conference on Machine Learning (ICML'23)\n>\n>[4] Schwaller P, Petraglia R, Zullo V, Nair VH, Haeuselmann RA, Pisoni R, et al. Predicting Retrosynthetic Pathways Using a Combined Linguistic Model and Hyper-Graph Exploration Strategy. ChemRxiv. Cambridge: Cambridge Open Engage; 2019."
                    }
                },
                "number": 19,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission7875/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700740041180,
                "cdate": 1700740041180,
                "tmdate": 1700740157990,
                "mdate": 1700740157990,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    }
]
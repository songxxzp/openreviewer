[
    {
        "title": "Sparse Backpropagation for MoE Training"
    },
    {
        "review": {
            "id": "7ZEetWWr0p",
            "forum": "1XDG1Z5Nhk",
            "replyto": "1XDG1Z5Nhk",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission4184/Reviewer_yUXn"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission4184/Reviewer_yUXn"
            ],
            "content": {
                "summary": {
                    "value": "This work investigates the problem non-differentiable of the expert selection, which is relevant in today Sparse Mixture of Experts (SMoE) implementations. Motivated from ODE methods, the proposed method, SparseMixer, derives a mid-point method to approximate the gradient with neglectable overhead. Experiments on pre-training, finetuning, and machine translation show that SparseMixer consistently outperforms SwitchTransformer and Dense training."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "3 good"
                },
                "contribution": {
                    "value": "2 fair"
                },
                "strengths": {
                    "value": "- SMoE has shown to be a promising direction to massively scale transformer models. This works investigates the non-differentiable problem of selection experts, which is at heart of existing SMoE strategies. \n- The proposed method is sound.\n- The empirical results are encouraging where SparseMixer consistently outperforms SwitchTransformer with neglectable overhead."
                },
                "weaknesses": {
                    "value": "## Major concern - limited broad impact\nAlthough the method is sound, it seems to be only applicable to the case of choosing only $1$ expert per layer. However, most modern architecture employ a TopK function that choose $k=2$ experts, which has shown to achieve better results, e.g.[A]. Thus, despite the encouraging results, it may not bring immediate impact.\n\n## Major concern - contribution of $\\omega$-scaling\n$\\omega$-scaling essentially makes the network deeper, thus using it improves the performance is easy to understand. However, it also makes comparing with SwitchTransformer to be unfair because of the additional trainable parameters. How would SwitchTransformer+$\\omega$-scaling performs against SparseMixer?\n\n## Major concern - complexity analysis\nI found the results in Table 3 to be questionable where SwitchTranformer and SparseMixer have identically average training costs. However, SparseMixer introduces several components such as $\\omega$-scaling, computing the gradient $\\nabla_0$, all of which contribute to the forward and backward computation. Thus, I think reporting the **total** training is more accurate to understand the overhead of SparseMixer.\n\n## Minor concern - limited baselines\nThe number of baselines considered is quite limited. The authors also considered a simple naive Transformer architecture. Other advanced architecture such as GLAM [A] and other SMoE strategies such as XMoE [B] should be included to make the experiment more comprehensive.\n\n## Minor concern - presentation\n- I suggest the author to replace \"MoE\" to \"SMoE\" as MoE usually refers to using all experts. This work consider the selecting only 1 expert, thus adding the \"sparse\" keyword would make the presentation clearer. \n- Best results are not highlighted in Table 2. \n\n[A] Du, Nan, et al. \"Glam: Efficient scaling of language models with mixture-of-experts.\" International Conference on Machine Learning. PMLR, 2022.\n\n[B] Chi, Zewen, et al. \"On the representation collapse of sparse mixture of experts.\" Advances in Neural Information Processing Systems 35 (2022): 34600-34613."
                },
                "questions": {
                    "value": "- Can SparseMixer be extended to $k>1$ easily?\n- Please clarify the empirical contribution of $\\omega$-scaling, i.e. comparing SparseMixer without $\\omega$-scaling with SwitchTransformer **OR** SparseMixer with SwitchTransformer + $\\omega$-scaling.\n- Please clarify the overhead in SparseMixer in Table 3 and report the total training time."
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "3: reject, not good enough"
                },
                "confidence": {
                    "value": "3: You are fairly confident in your assessment. It is possible that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work. Math/other details were not carefully checked."
                },
                "code_of_conduct": {
                    "value": "Yes"
                },
                "first_time_reviewer": {
                    "value": "Yes",
                    "readers": [
                        "ICLR.cc/2024/Conference/Program_Chairs",
                        "ICLR.cc/2024/Conference/Submission4184/Senior_Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission4184/Area_Chairs",
                        "ICLR.cc/2024/Conference/Submission4184/Reviewer_yUXn"
                    ]
                }
            },
            "number": 1,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission4184/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698675634754,
            "cdate": 1698675634754,
            "tmdate": 1699636384492,
            "mdate": 1699636384492,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "unZRjunXC0",
                "forum": "1XDG1Z5Nhk",
                "replyto": "7ZEetWWr0p",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission4184/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission4184/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Rebuttal by Authors"
                    },
                    "comment": {
                        "value": "Thank you for your comprehensive feedback. We appreciate the opportunity to clarify and expand on the strengths of our approach, with further elaborations to be included in the final paper.\n\n**Reply to presentation:**\n\nWe appreciate your suggestion regarding the term. We have retained \"MoE\" in our manuscript, as it is a widely recognized term in the literature, predominantly referring to sparsely activated networks [1,2,3]. Also, we would like to acknowledge that \"SMoE\" could potentially lead to confusion, as it might be misconstrued as Soft MoE [4]. \n1. Adaptive mixtures of local experts. Neural Computation 1991\n2. Hierarchical mixtures of experts and the em algorithm. Neural Computation 1994\n3. Switch Transformers: Scaling to Trillion Parameter Models with Simple and Efficient Sparsity. 2021\n4. From Sparse to Soft Mixtures of Experts. NeurIPS 2022\n\n**Reply to Efficiency Evaluation:**\n\nTable 3 in our initial submission summarized the wall-clock time per epoch (excluding checkpoint saving) and took into account all components of SparseMixer, including omega scaling. To provide further clarity, we have now added Figure 5, which compares the training FLOPs ratio between Switch and Switch+SparseMixer configurations.\n\n**Reply to Omega Scaling:**\nTo evaluate the impact of Omega scaling, we conducted a specific ablation study, which is presented as ablation-1 SparseMixer variant in Figure 1 of our submission. This variant excludes Omega scaling from SparseMixer, allowing for a direct comparison of its effects.\n\n**Reply to Research Scope:**\nEarly on, neural networks were trained using a variety of update rules, such as the classical Winnow algorithm and the Perceptron algorithm. Given that these algorithms were largely handcrafted, generalizing these update rules to accommodate deeper and more intricate neural networks posed significant challenges.\n\nThe introduction of the backpropagation algorithm and the stochastic gradient descent algorithm re-anchored the foundation of neural networks to the principles of gradient descent and the chain rule, mirroring the foundational ideas behind least squares computation. This paradigm shift has been instrumental, with the vast majority of neural network research post-2000 relying on this update rule.\n\nHowever, backpropagation cannot be directly applied to sparse model training. Accordingly, many attempts have been made to derive ad-hoc proxy for gradient computation and gradient descent. However, there is no guarantee the resulting estimation can be viewed as a gradient approximation, and it is not clear doing gradient descent with these proxies can lead to a descent. \n\nOur study reveals the underlying connection between the current MoE training practice and gradient approximation. It not only re-anchored MoE training as gradient descent at-scale paradigm, but also provides guidance on how to obtain better gradient estimation. \n\nSince our algorithm provides better gradient estimation, the gradient-based optimizer would be more effective at more training, thus leading to better model training (accelerating model training by up to 2 times). \n\n**Reply to Experiment Design:**\n\nIn our submission, we adhered to the experiment design of the existing study, focusing on normal-scale problems for controllability and resource efficiency. For example, choosing ELECTRA-base as the pre-training task allows us to conduct experiments with multiple settings. As a comparison, typical ELECTRA-base model training takes 125k steps and typical BERT-base model training takes 1M steps. \n\nWhile our method has potential applications in different scales and MoE gating methods, the focus of this study is on foundational gradient estimation. Scaling and adapting our method for varied MoE paradigms presents both research and engineering challenges. We aim to explore these in future work, considering our current computational resource constraints.\n\n**Reply to SparseMixer Application on Top-k Routing:**\n\nSparseMixer is for estimating gradients involving discrete random variables with only sparse backpropagation. In principle, it is applicable to other MoE routing algorithms. The only bottleneck for applying SparseMixer is that it requires the expert index is explicitly sampled from a parameterized distribution, which requires us to apply some adaptation to Switch Transformer / top-1 routing."
                    }
                },
                "number": 9,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission4184/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700731169424,
                "cdate": 1700731169424,
                "tmdate": 1700731169424,
                "mdate": 1700731169424,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "OAVdFfhefE",
            "forum": "1XDG1Z5Nhk",
            "replyto": "1XDG1Z5Nhk",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission4184/Reviewer_tyBo"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission4184/Reviewer_tyBo"
            ],
            "content": {
                "summary": {
                    "value": "This paper proposes SparseMixer to move beyond discrete and bridge the gap between sparse MoE routing and backpropagation. SparseMixer utilizes a second-order ODE solver to deliver precise gradient approximations. Their experiments show SparseMixer not only accelerates training convergence by up to two times but also facilitates MoE with properly trained expert routing."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "2 fair"
                },
                "contribution": {
                    "value": "2 fair"
                },
                "strengths": {
                    "value": "1. The pre-training of LLMs is costly, and MoE is one promising sparse training method to reduce the training overhead. The paper makes some contributions to improving the backpropagation of MoE Training.\n\n2. The experiment results show the effectiveness of the proposed methods on a specific model."
                },
                "weaknesses": {
                    "value": "My concern includes two aspects:\n\n1. The experiment is kind of weak since there are also some other MoE architecture and other base models, while the authors only focus on Switch. Currently, the author only focuses on a simplified setting of the switch Transformer layer (Fedus et al., 2021). However, there are also other popular MoE architectures, e.g. (Shazeer et al., 2017; Lepikhin et al., 2020; Lewis et al., 2021) as mentioned in the paper, and (Yanqi et al., 2022; Nan et al., 2022) in the following.\n\nZhou, Yanqi, Tao Lei, Hanxiao Liu, Nan Du, Yanping Huang, Vincent Zhao, Andrew M. Dai, Quoc V. Le, and James Laudon. \"Mixture-of-experts with expert choice routing.\" Advances in Neural Information Processing Systems 35 (2022): 7103-7114. Du, Nan, Yanping Huang, \n\nAndrew M. Dai, Simon Tong, Dmitry Lepikhin, Yuanzhong Xu, Maxim Krikun et al. \"Glam: Efficient scaling of language models with mixture-of-experts.\" In International Conference on Machine Learning, pp. 5547-5569. PMLR, 2022.\n\n2. The writing of Section 3 is too fragmented and can be improved a lot. I would recommend authors to enrich Sections 3.2 and 3.2, since currently, they read like an experiment report with step-by-step procedures, instead of a well-written technical paper with good motivation and intuition of the proposed techniques."
                },
                "questions": {
                    "value": "1. Can the authors explicitly present the physical running time? The results in the experiment section do not give a clear comparison.\n\n2. What is the experiment platform, e.g. torch version or GPU model?"
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "6: marginally above the acceptance threshold"
                },
                "confidence": {
                    "value": "3: You are fairly confident in your assessment. It is possible that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work. Math/other details were not carefully checked."
                },
                "code_of_conduct": {
                    "value": "Yes"
                }
            },
            "number": 2,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission4184/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698759671237,
            "cdate": 1698759671237,
            "tmdate": 1699636384403,
            "mdate": 1699636384403,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "u2nlvWBv1F",
                "forum": "1XDG1Z5Nhk",
                "replyto": "OAVdFfhefE",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission4184/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission4184/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Rebuttal by Authors"
                    },
                    "comment": {
                        "value": "Thank you for your comprehensive feedback. We appreciate the opportunity to clarify and expand on the strengths of our approach, with further elaborations to be included in the final paper.\n\n**Reply to weakness 1 (scope of study)**\n\nOur study primarily focuses on gradient estimation in MoE training. \n\nEarly on, neural networks were trained using a variety of update rules, such as the classical Winnow algorithm and the Perceptron algorithm. Given that these algorithms were largely handcrafted, generalizing these update rules to accommodate deeper and more intricate neural networks posed significant challenges.\n\nThe introduction of the backpropagation algorithm and the stochastic gradient descent algorithm re-anchored the foundation of neural networks to the principles of gradient descent and the chain rule, mirroring the foundational ideas behind least squares computation. This paradigm shift has been instrumental, with the vast majority of neural network research post-2000 relying on this update rule.\n\nHowever, backpropagation cannot be directly applied to sparse model training. Accordingly, many attempts have been made to derive ad-hoc proxy for gradient computation and gradient descent. However, there is no guarantee the resulting estimation can be viewed as a gradient approximation, and it is not clear doing gradient descent with these proxies can lead to a descent. \n\nOur work bridges this gap by revealing the intrinsic connection between current MoE training practices and gradient approximation. This not only repositions MoE training within the gradient descent paradigm at scale but also guides more accurate gradient estimation. \n\n**Reply to weakness 1 (significance of performance gain):**\n\nWe believe the improvement brought by SparseMixer is significant. Regarding training convergence, SparseMixer accelerates model training by up to two times. Regarding downstream performance, the best performance achieved by SparseMixer is 28.72 on WMT\u201914 EN-DE (note our architecture configuration is based on Transformer-base) and 88.31 on GLUE (note our architecture configuration is based on Electra-base). \n\nIt's important to note that the improvements on GLUE are actually significant, as GLUE is a very competitive benchmark, Most leading methods on the GLUE benchmark (as in https://gluebenchmark.com/leaderboard) are based on the Electra-large setting and their improvements over the previous methods are usually within 0.2 absolute points. In our study, simply applying SparseMixer to Electra-base training without any pre-training hyper-parameter re-tuning, we achieve a consistent 0.5 absolute point improvements. \n\n\n\nWhile our method has potential applications in different scales and MoE gating methods, the focus of this study is on foundational gradient estimation. Scaling and adapting our method for varied MoE paradigms presents both research and engineering challenges. We aim to explore these in future work, considering our current computational resource constraints.\n\n\n**Reply to weakness 2 (Section 3 writing)**\nWe appreciate your feedback on Section 3. The section has been revised for improved coherence, focusing on the rationale and intuition behind our techniques rather than merely describing experimental procedures.\n\n**Reply to question 1**\nIn our submission, Table 3 summarizes the wall-clock time for the model training (measured by total training time per epoch without checkpoint saving, divided by number of updates). In our revised submission, Figure 5 summarizes the training FLOPs ratio between Switch and Switch+SparseMixer. \n\n**Reply to question 2**\nFollowing previous study, we used the `nvidia/pytorch:22.04-py3` docker image for the pre-training task and the `nvidia/pytorch:22.02-py3`docker image for the NMT task. The training was primarily conducted on V100 GPUs, with some fine-tuning on P40/P100 GPUs."
                    }
                },
                "number": 8,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission4184/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700730963385,
                "cdate": 1700730963385,
                "tmdate": 1700730963385,
                "mdate": 1700730963385,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "9Obodj9J6a",
            "forum": "1XDG1Z5Nhk",
            "replyto": "1XDG1Z5Nhk",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission4184/Reviewer_D3YK"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission4184/Reviewer_D3YK"
            ],
            "content": {
                "summary": {
                    "value": "The paper presents SparseMixer, a scalable gradient estimator that bridges the gap between backpropagation and sparse expert routing.  In specific, the paper presents SparseMixer to provide scalable gradient approximations for the gradients terms that are not taken into account, enabling reliable gradient estimation in MoE training. The authors demonstrate SparseMixer to Switch Transformer on both pre-training and machine translation tasks, with the claim of considerable performance gain, accelerating training convergence by up to 2 times."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "3 good"
                },
                "contribution": {
                    "value": "3 good"
                },
                "strengths": {
                    "value": "1. The idea of improving gradient computation at scale to improve MoE training is novel to me.\n\n2.The paper consistently demonstrate the impact of neglecting $\\Delta_0$ in the pre-training with MoE.\n\n3. The paper is written well and the results back up the improvement."
                },
                "weaknesses": {
                    "value": "1. Straight-Through (ST) -- > straight through estimator (STE) ? \n\n2. Please define ODE first in the abstract before using the abbr.\n\n3. Please introduce definitions of $\\Delta_0$ and $\\Delta_1$.\n\n4. It is not quite clear why the training speed improves.\n\n5. Please demonstrate results with other MoE gating methods. as few of them tried to improve MoE training."
                },
                "questions": {
                    "value": "Please see weakness."
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "rating": {
                    "value": "5: marginally below the acceptance threshold"
                },
                "confidence": {
                    "value": "3: You are fairly confident in your assessment. It is possible that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work. Math/other details were not carefully checked."
                },
                "code_of_conduct": {
                    "value": "Yes"
                }
            },
            "number": 3,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission4184/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698768034868,
            "cdate": 1698768034868,
            "tmdate": 1699636384333,
            "mdate": 1699636384333,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "9ST6dQoigC",
                "forum": "1XDG1Z5Nhk",
                "replyto": "9Obodj9J6a",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission4184/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission4184/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Rebuttal by Authors"
                    },
                    "comment": {
                        "value": "Thank you for your comprehensive feedback. We appreciate the opportunity to clarify and expand on the strengths of our approach, with further elaborations to be included in the final paper.\n\n**Reply to weakness 1 (terminology)** \nWe choose ST as the abbreviation, since ST is a widely used terminology in the literature [1,2,3].\n\n[1] Bridging Discrete and Backpropagation: Straight-Through and Beyond. NeurIPS 2023\n\n[2] Training discrete deep generative models via gapped straight-through estimator. ICML 2022\n\n[3] Rao-blackwellizing the straight-through gumbel softmax gradient estimator. ICLR 2021\n\n**Reply to weakness 2 (Definition of ODE in Abstract)**\nThanks for the suggestion! We have revised our abstract to include a clear definition of Ordinary Differential Equations (ODE) at its first mention.\n\n**Reply to weakness 3 (Definition of $\\nabla_0$ and $\\nabla_1$)**\n$\\nabla_0$ and $\\nabla_1$ are defined in Section 2 (Equation 2). In response to your feedback, we have added references in Section 3 of the revised manuscript for easier navigation and understanding.\n\n**Reply to weakness 4 (Clarification on the Mechanism of SparseMixer)**\nThe improved training speed is a result of our enhanced gradient estimation. \n\nEarly on, neural networks were trained using a variety of update rules, such as the classical Winnow algorithm and the Perceptron algorithm. Given that these algorithms were largely handcrafted, generalizing these update rules to accommodate deeper and more intricate neural networks posed significant challenges.\n\nThe introduction of the backpropagation algorithm and the stochastic gradient descent algorithm re-anchored the foundation of neural networks to the principles of gradient descent and the chain rule, mirroring the foundational ideas behind least squares computation. This paradigm shift has been instrumental, with the vast majority of neural network research post-2000 relying on this update rule.\n\nSince backpropagation cannot be directly applied to sparse model training, many attempts have been made to derive ad-hoc proxy for gradient computation and gradient descent. However, there is no guarantee the resulting estimation can be viewed as a gradient approximation, and it is not clear doing gradient descent with these proxies can lead to a descent. \n\nOur study reveals the underlying connection between the current MoE training practice and gradient approximation. It not only re-anchored MoE training as gradient descent at-scale paradigm, but also provides guidance on how to obtain better gradient estimation. \n\nSince our algorithm provides better gradient estimation, the gradient-based optimizer would be more effective at more training, thus leading to better model training. \n\n**Reply to weakness 5 (Exploration of Other MoE Gating Methods)** While our method has potential applications in different scales and MoE gating methods, the focus of this study is on foundational gradient estimation. Scaling and adapting our method for varied MoE paradigms presents both research and engineering challenges. We aim to explore these in future work, considering our current computational resource constraints."
                    }
                },
                "number": 7,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission4184/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700730866281,
                "cdate": 1700730866281,
                "tmdate": 1700730866281,
                "mdate": 1700730866281,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    },
    {
        "review": {
            "id": "CiRkoiJCgs",
            "forum": "1XDG1Z5Nhk",
            "replyto": "1XDG1Z5Nhk",
            "signatures": [
                "ICLR.cc/2024/Conference/Submission4184/Reviewer_4GtZ"
            ],
            "nonreaders": [],
            "readers": [
                "everyone"
            ],
            "writers": [
                "ICLR.cc/2024/Conference",
                "ICLR.cc/2024/Conference/Submission4184/Reviewer_4GtZ"
            ],
            "content": {
                "summary": {
                    "value": "This paper attempts to address the backpropagation issue of Mixture of Experts (MoE). There is a growing interest in sparsely activated networks, specifically Mixture-of-Experts (MoE), which selectively activate parts of modules for specific inputs, leading to efficiency improvements. However, gradient estimation in MoE is challenging due to the non-differentiable nature of expert routing. Existing methods like Straight-Through (ST) estimators are not compatible with MoE, which leads to the neglect of gradient computation for routing during training, impacting convergence and model quality. The paper introduces SparseMixer, a novel approach that reconciles sparse MoE routing and backpropagation using numerical methods for ordinary differential equations. SparseMixer provides reliable gradient approximations even with a subset of experts activated and accelerates training convergence by up to two times. It also enables MoE models to consistently outperform dense models when used with Switch Transformer."
                },
                "soundness": {
                    "value": "3 good"
                },
                "presentation": {
                    "value": "3 good"
                },
                "contribution": {
                    "value": "2 fair"
                },
                "strengths": {
                    "value": "(1) This paper discusses an very important research question in MoE, the backpropoagation issue of routing function, which is easily be overlooked by researchers if not be pointed out specifically. This research question is timely and important. \n\n(2)  The first order approximation used in this paper only requires the output of one expert, not sacrificing scalability.\n\n(3) SparseMixer does not require hessian or other second-order derivatives, having negligible computation overheads."
                },
                "weaknesses": {
                    "value": "(1) While SparseMixer achieves consistently improvement over the vanilla Switch Transformer, what I can see is the improvement is a bit marginal in Table1. Esp. as the number of experts increases, the performance gains become more marginal. My conjecture is that the main evaluation task in the paper, GLUE, is two simple to demonstrate the empirical benefits of SparseMixer. I would like to see more results on more challenging tasks, where the performance gains of S+S might be larger. \n\n(2) The marginal performance improvement is also contradictory to the authors' motivation. If the neglect of the gradient computation for\nrouting is indeed crucial for MoE, we should see much significant improvements. \n\n(3) What is the cost induced by SparseMixer? Table 3 does not provide enough information to justify the overheads. Can we see any time difference as the number of experts continues to increase?"
                },
                "questions": {
                    "value": "Please see the above Weaknesses."
                },
                "flag_for_ethics_review": {
                    "value": [
                        "No ethics review needed."
                    ]
                },
                "details_of_ethics_concerns": {
                    "value": "n/a"
                },
                "rating": {
                    "value": "5: marginally below the acceptance threshold"
                },
                "confidence": {
                    "value": "4: You are confident in your assessment, but not absolutely certain. It is unlikely, but not impossible, that you did not understand some parts of the submission or that you are unfamiliar with some pieces of related work."
                },
                "code_of_conduct": {
                    "value": "Yes"
                }
            },
            "number": 4,
            "invitations": [
                "ICLR.cc/2024/Conference/Submission4184/-/Official_Review",
                "ICLR.cc/2024/Conference/-/Edit"
            ],
            "domain": "ICLR.cc/2024/Conference",
            "tcdate": 1698947665570,
            "cdate": 1698947665570,
            "tmdate": 1699636384264,
            "mdate": 1699636384264,
            "license": "CC BY 4.0",
            "version": 2
        },
        "responses": [
            {
                "id": "lBzrdjCTx7",
                "forum": "1XDG1Z5Nhk",
                "replyto": "CiRkoiJCgs",
                "signatures": [
                    "ICLR.cc/2024/Conference/Submission4184/Authors"
                ],
                "readers": [
                    "everyone"
                ],
                "writers": [
                    "ICLR.cc/2024/Conference",
                    "ICLR.cc/2024/Conference/Submission4184/Authors"
                ],
                "content": {
                    "title": {
                        "value": "Rebuttal by Authors"
                    },
                    "comment": {
                        "value": "Thank you for your comprehensive feedback. We appreciate the opportunity to clarify and expand on the strengths of our approach, with further elaborations to be included in the final paper.\n\n**Reply to weakness 1 (experiment design and performance on GLUE):** \n\nIn our submission, we adhered to the experiment design of the existing study, focusing on normal-scale problems for controllability and resource efficiency. For example, choosing ELECTRA-base as the pre-training task allows us to conduct experiments with multiple settings. As a comparison, typical ELECTRA-base model training takes 125k steps and typical BERT-base model training takes 1M steps. \n\nAs to performance, we believe the improvement brought by SparseMixer is significant. Regarding training convergence, SparseMixer accelerates model training by up to two times. Regarding downstream performance, the best performance achieved by SparseMixer is 28.72 on WMT\u201914 EN-DE (note our architecture configuration is based on Transformer-base) and 88.31 on GLUE (note our architecture configuration is based on Electra-base). \n\nIt's important to note that the improvements on GLUE are actually significant, as GLUE is a very competitive benchmark. Most leading methods on the GLUE benchmark (as in https://gluebenchmark.com/leaderboard) are based on the Electra-large setting and their improvements over the previous methods are usually within 0.2 absolute points. In our study, simply applying SparseMixer to Electra-base training without any pre-training hyper-parameter re-tuning, we achieve a consistent 0.5 absolute point improvements. \n\nExpanding our experiments to larger-scale problems or different MoE training paradigms is an exciting direction for future research. We acknowledge the combined research and engineering challenges this entails and look forward to exploring these possibilities as resources permit.\n\n**Reply to weakness 2 (Gradient Computation and Connection to Current Practice)**\nThanks for the insightful suggestion! In our revised manuscript, we delve deeper into the relationship between our proposed first-order approximation and existing MoE training methodologies. Our analysis reveals that the common practice of ignoring certain gradient components is akin to reducing gradient scaling, a factor that adaptive optimizers like Adam can inherently adjust to. This insight not only validates our approach but also elucidates the underlying mechanics of current MoE training practices.\n\nTo demonstrate this, please see the comparison between Switch and SparseMixer-ablation-2 (it fixes such additional bias by changing the sampling and avoiding the routing gradient downscale) in Figure 1. For more detailed discussion, please see Section 3.3 in the revised submission. \n\n**Reply to weakness 3 (Computational Overheads of SparseMixer)**\nSparseMixer has the same compute complexity and memory complexity with the current practice (dropping $\\nabla_0$ completely). To further demonstrate this, we visualized the FLOPS ratio of Switch and SparseMixer in Figure 5 for $\\\\{2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384\\\\}$. The computation overheads brought by SparseMixer only compose for less than $0.1\\%$ of the training FLOPS."
                    }
                },
                "number": 6,
                "invitations": [
                    "ICLR.cc/2024/Conference/Submission4184/-/Official_Comment"
                ],
                "domain": "ICLR.cc/2024/Conference",
                "tcdate": 1700730724252,
                "cdate": 1700730724252,
                "tmdate": 1700730724252,
                "mdate": 1700730724252,
                "license": "CC BY 4.0",
                "version": 2
            }
        ]
    }
]